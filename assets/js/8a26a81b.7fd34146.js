"use strict";(self.webpackChunkintellisense_form_docs=self.webpackChunkintellisense_form_docs||[]).push([[2905],{3905:function(t,e,n){n.d(e,{Zo:function(){return p},kt:function(){return d}});var o=n(67294);function r(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function i(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function a(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?i(Object(n),!0).forEach((function(e){r(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function s(t,e){if(null==t)return{};var n,o,r=function(t,e){if(null==t)return{};var n,o,r={},i=Object.keys(t);for(o=0;o<i.length;o++)n=i[o],e.indexOf(n)>=0||(r[n]=t[n]);return r}(t,e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);for(o=0;o<i.length;o++)n=i[o],e.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(t,n)&&(r[n]=t[n])}return r}var l=o.createContext({}),u=function(t){var e=o.useContext(l),n=e;return t&&(n="function"==typeof t?t(e):a(a({},e),t)),n},p=function(t){var e=u(t.components);return o.createElement(l.Provider,{value:e},t.children)},m={inlineCode:"code",wrapper:function(t){var e=t.children;return o.createElement(o.Fragment,{},e)}},c=o.forwardRef((function(t,e){var n=t.components,r=t.mdxType,i=t.originalType,l=t.parentName,p=s(t,["components","mdxType","originalType","parentName"]),c=u(n),d=r,f=c["".concat(l,".").concat(d)]||c[d]||m[d]||i;return n?o.createElement(f,a(a({ref:e},p),{},{components:n})):o.createElement(f,a({ref:e},p))}));function d(t,e){var n=arguments,r=e&&e.mdxType;if("string"==typeof t||r){var i=n.length,a=new Array(i);a[0]=c;var s={};for(var l in e)hasOwnProperty.call(e,l)&&(s[l]=e[l]);s.originalType=t,s.mdxType="string"==typeof t?t:r,a[1]=s;for(var u=2;u<i;u++)a[u]=n[u];return o.createElement.apply(null,a)}return o.createElement.apply(null,n)}c.displayName="MDXCreateElement"},66342:function(t,e,n){n.r(e),n.d(e,{frontMatter:function(){return s},contentTitle:function(){return l},metadata:function(){return u},toc:function(){return p},default:function(){return c}});var o=n(87462),r=n(63366),i=(n(67294),n(3905)),a=["components"],s={id:"guide-button",title:"开发一个按钮"},l=void 0,u={unversionedId:"guide-button",id:"guide-button",title:"开发一个按钮",description:"上一个章节我们学会了开发简单的按钮，这个章节以一个自定义的表单保存按钮为例，讲解如何开发一个较为完整的流程按钮。通过此章节，您将学会流程按钮如何与表单数据进行交互，这也是流程按钮的精髓所在。",source:"@site/docs/guide-button.mdx",sourceDirName:".",slug:"/guide-button",permalink:"/intellisense-form-website/docs/guide-button",tags:[],version:"current",frontMatter:{id:"guide-button",title:"开发一个按钮"},sidebar:"someSidebar",previous:{title:"开发第一个插件",permalink:"/intellisense-form-website/docs/guide-hello"},next:{title:"开发一个表单控件",permalink:"/intellisense-form-website/docs/guide-formfield"}},p=[{value:"开发基本的按钮组件",id:"开发基本的按钮组件",children:[],level:2},{value:"通过属性获取到表单状态",id:"通过属性获取到表单状态",children:[],level:2},{value:"点击按钮保存表单",id:"点击按钮保存表单",children:[],level:2},{value:"在智能表单产品中调试插件",id:"在智能表单产品中调试插件",children:[],level:2}],m={toc:p};function c(t){var e=t.components,s=(0,r.Z)(t,a);return(0,i.kt)("wrapper",(0,o.Z)({},m,s,{components:e,mdxType:"MDXLayout"}),(0,i.kt)("p",null,"上一个章节我们学会了开发简单的按钮，这个章节以一个自定义的表单保存按钮为例，讲解如何开发一个较为完整的流程按钮。通过此章节，您将学会流程按钮如何与表单数据进行交互，这也是流程按钮的精髓所在。"),(0,i.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"示例源码")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"本章节得示例代码可以在",(0,i.kt)("a",{parentName:"p",href:"https://gitee.com/sinoui/sinoform-plugins-web-component-examples/blob/master/src/plugins/flow-button-custom-save/"},"sinoform-plugins-web-component-examples/src/plugins/flow-button-custom-save"),"中找到。"))),(0,i.kt)("h2",{id:"开发基本的按钮组件"},"开发基本的按钮组件"),(0,i.kt)("p",null,"我们按照上个章节介绍的方法，快速实现一个基本的按钮组件："),(0,i.kt)("p",null,"组件："),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-ts",metastring:'title="src/plugins/flow-button-custom-save/CustomSaveButton.ts"',title:'"src/plugins/flow-button-custom-save/CustomSaveButton.ts"'},'import $ from "jQuery";\nimport { SinoFormElement } from "@sinoform/plugin-sinoform-helpers";\nimport "./CustomSaveButton.css";\n\n/**\n * 定义CustomSaveButton组件\n */\nexport default class CustomSaveButton extends SinoFormElement {\n  onClick() {\n    console.log("保存按钮被点击了");\n  }\n\n  override render() {\n    // 生成DOM节点模板字符串\n    this.innerHTML = `<button class="custom-save-button">新的保存</button>`;\n\n    // 监听保存按钮的点击事件\n    $(".custom-save-button", this).on("click", this.onClick.bind(this));\n  }\n}\n')),(0,i.kt)("p",null,"组件样式："),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-css",metastring:'title="src/plugins/flow-button-custom-save/CustomSaveButton.css"',title:'"src/plugins/flow-button-custom-save/CustomSaveButton.css"'},".custom-save-button {\n  color: #fff;\n  background-color: #2196f3;\n  font-size: 0.875rem;\n  border: none;\n  height: 36px;\n  margin: 8px;\n}\n")),(0,i.kt)("p",null,"包装为 React 组件："),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-typescript",metastring:'title="src/plugins/flow-button-custom-save/index.ts"',title:'"src/plugins/flow-button-custom-save/index.ts"'},'import { wrapperWebComponent } from "@sinoform/plugin-sinoform-helpers";\nimport CustomSaveButton from "./CustomSaveButton";\n\n// 包装成React组件并默认导出\nexport default wrapperWebComponent("flow-button-custom-save", CustomSaveButton);\n')),(0,i.kt)("p",null,"接下来注册到表单中去："),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-typescript",metastring:'title="src/index.ts"',title:'"src/index.ts"'},'import AppSetting from "@sinoform/app-setting";\n\nAppSetting.flowConfig.addButton({\n  id: "custom-save-button",\n  name: "新的保存",\n  render: React.lazy(() => import("./plugins/flow-button-custom-save")),\n});\n')),(0,i.kt)("p",null,"最后可以在演示系统中查看效果。点击新的保存按钮，会在控制台输出 ",(0,i.kt)("inlineCode",{parentName:"p"},"保存按钮被点击了"),"。接下来我们需要改动 ",(0,i.kt)("inlineCode",{parentName:"p"},"onClick")," 方法，点击按钮时保存表单数据。要想保存数据，首先需要通过属性的方式获取到表单状态，我们马上进入下个章节，学习一下如何获取到表单状态。"),(0,i.kt)("h2",{id:"通过属性获取到表单状态"},"通过属性获取到表单状态"),(0,i.kt)("p",null,"表单会给流程按钮组件传递以下属性："),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"formState")," - 表单状态"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"detailPage")," - 详情页数据"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"appInfo")," - 应用级别的信息，包括当前用户信息")),(0,i.kt)("p",null,"我们可以从 props 中直接读取对应的属性值，比如我们点击保存按钮时需要获取当前的表单状态，就可以使用如下的方式来获取"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-typescript"},"const { formState } = this.props;\n")),(0,i.kt)("p",null,"有了属性，我们就可以在 ",(0,i.kt)("inlineCode",{parentName:"p"},"onClick")," 方法中调用表单状态对象的提交方法。请看下一个章节。"),(0,i.kt)("h2",{id:"点击按钮保存表单"},"点击按钮保存表单"),(0,i.kt)("p",null,"这个小结我们完善 ",(0,i.kt)("inlineCode",{parentName:"p"},"onClick")," 方法，来实现点击保存按钮时，提交表单："),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-typescript",metastring:'title="src/plugins/flow-button-custom-save/CustomSaveButton.ts"',title:'"src/plugins/flow-button-custom-save/CustomSaveButton.ts"'},'import { SinoFormElement } from "@sinoform/plugin-sinoform-helpers";\nimport $ from "jquery";\nimport "./CustomSaveButton.css";\n\n/**\n * 定义CustomSaveButton组件\n */\nexport default class CustomSaveButton extends SinoFormElement {\n  async onClick() {\n    const { formState } = this.props;\n    if (!formState) {\n      return;\n    }\n\n    // 执行表单校验\n    const isValid = formState.validate();\n\n    if (!isValid) {\n      alert("表单校验不通过，不能保存表单");\n      return;\n    }\n\n    try {\n      // 提交表单\n      await formState.submit();\n      alert("保存表单成功");\n    } catch (e) {\n      alert("保存表单失败");\n    }\n  }\n}\n')),(0,i.kt)("p",null,"这样，我们新的保存按钮就开发完了，完整的 ",(0,i.kt)("inlineCode",{parentName:"p"},"CustomSaveButton.ts")," 文件代码如下："),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-typescript",metastring:'title="src/plugins/flow-button-custom-save/CustomSaveButton.ts"',title:'"src/plugins/flow-button-custom-save/CustomSaveButton.ts"'},'import { SinoFormElement } from "@sinoform/plugin-sinoform-helpers";\nimport $ from "jquery";\nimport "./CustomSaveButton.css";\n\n/**\n * 定义CustomSaveButton组件\n */\nexport default class CustomSaveButton extends SinoFormElement {\n  async onClick() {\n    const { formState } = this.props;\n    if (!formState) {\n      return;\n    }\n\n    // 执行表单校验\n    const isValid = formState.validate();\n\n    if (!isValid) {\n      alert("表单校验不通过，不能保存表单");\n      return;\n    }\n\n    try {\n      // 提交表单\n      await formState.submit();\n      alert("保存表单成功");\n    } catch (e) {\n      alert("保存表单失败");\n    }\n  }\n\n  override render() {\n    // 生成DOM节点模板字符串\n    this.innerHTML = \'<button class="custom-save-button">新的保存</button>\';\n\n    // 监听保存按钮的点击事件\n    $(".custom-save-button", this).on("click", this.onClick.bind(this));\n  }\n}\n')),(0,i.kt)("h2",{id:"在智能表单产品中调试插件"},"在智能表单产品中调试插件"),(0,i.kt)("p",null,"本小节以智能表单外网演示环境来说明如何在智能表单产品中调试插件。"),(0,i.kt)("p",null,"打开",(0,i.kt)("a",{parentName:"p",href:"http://121.30.232.162:18880/sso/"},"登录页"),"，使用账号 ",(0,i.kt)("inlineCode",{parentName:"p"},"智能表单管理员"),"（密码是：",(0,i.kt)("inlineCode",{parentName:"p"},"1qaz2wsx!"),"） 登录系统，然后选择表单设计器，进入智能表单管理页面。"),(0,i.kt)("p",null,"打开表单",(0,i.kt)("inlineCode",{parentName:"p"},"演示自定义保存按钮"),"，在流程设计界面，选择审批节点，然后右侧更多属性中就可以看到新增的 CustomSaveButton 按钮"),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"流程配置界面",src:n(20073).Z})),(0,i.kt)("p",null,"进入产品示例系统，在",(0,i.kt)("inlineCode",{parentName:"p"},"演示自定义保存按钮"),"的待办列表审批节点的表单详情页中可以看到我们新增的按钮"),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"详情界面",src:n(321).Z})),(0,i.kt)("p",null,"这个时候我们就可以修改表单项的值，测试按钮的保存功能了。"))}c.isMDXComponent=!0},20073:function(t,e,n){e.Z=n.p+"assets/images/customsavebtn-in-design-52f5afd245923393ca5ee03e4bd5a234.png"},321:function(t,e,n){e.Z=n.p+"assets/images/customsavebtn-in-detail-64fcd60428709145e9ddff727a25bd6d.png"}}]);