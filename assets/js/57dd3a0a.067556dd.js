"use strict";(self.webpackChunkintellisense_form_docs=self.webpackChunkintellisense_form_docs||[]).push([[3961],{3905:function(e,n,t){t.d(n,{Zo:function(){return s},kt:function(){return d}});var l=t(67294);function a(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function i(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);n&&(l=l.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,l)}return t}function r(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?i(Object(t),!0).forEach((function(n){a(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):i(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function o(e,n){if(null==e)return{};var t,l,a=function(e,n){if(null==e)return{};var t,l,a={},i=Object.keys(e);for(l=0;l<i.length;l++)t=i[l],n.indexOf(t)>=0||(a[t]=e[t]);return a}(e,n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(l=0;l<i.length;l++)t=i[l],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(a[t]=e[t])}return a}var c=l.createContext({}),p=function(e){var n=l.useContext(c),t=n;return e&&(t="function"==typeof e?e(n):r(r({},n),e)),t},s=function(e){var n=p(e.components);return l.createElement(c.Provider,{value:n},e.children)},u={inlineCode:"code",wrapper:function(e){var n=e.children;return l.createElement(l.Fragment,{},n)}},m=l.forwardRef((function(e,n){var t=e.components,a=e.mdxType,i=e.originalType,c=e.parentName,s=o(e,["components","mdxType","originalType","parentName"]),m=p(t),d=a,f=m["".concat(c,".").concat(d)]||m[d]||u[d]||i;return t?l.createElement(f,r(r({ref:n},s),{},{components:t})):l.createElement(f,r({ref:n},s))}));function d(e,n){var t=arguments,a=n&&n.mdxType;if("string"==typeof e||a){var i=t.length,r=new Array(i);r[0]=m;var o={};for(var c in n)hasOwnProperty.call(n,c)&&(o[c]=n[c]);o.originalType=e,o.mdxType="string"==typeof e?e:a,r[1]=o;for(var p=2;p<i;p++)r[p]=t[p];return l.createElement.apply(null,r)}return l.createElement.apply(null,t)}m.displayName="MDXCreateElement"},82660:function(e,n,t){t.d(n,{Z:function(){return i}});var l=t(67294),a=function(e){var n=e.version,t=e.type,a="font"===t?"dynamic-font-server-v"+n+".zip":"sino-intellisense-form-v"+n+"."+("backend"===t?"jar":"zip"),i="http://sino-intellisense-form.oss-cn-beijing.aliyuncs.com/v"+n+"/"+a;return l.createElement("a",{href:i},a)},i=function(e){var n=e.font,t=e.frontend,i=e.backend,r=e.version;return l.createElement("table",null,l.createElement("thead",null,l.createElement("tr",null,l.createElement("th",null,"发布包名称"),l.createElement("th",null,"下载链接"))),l.createElement("tbody",null,l.createElement("tr",null,l.createElement("td",null,"前端包",r===t?"（新版本）":""),l.createElement("td",null,l.createElement(a,{type:"frontend",version:t}))),l.createElement("tr",null,l.createElement("td",null,"后端包",r===i?"（新版本）":""),l.createElement("td",null,l.createElement(a,{type:"backend",version:i}))),n&&l.createElement("tr",null,l.createElement("td",null,"字体服务",r===n?"（新版本）":""),l.createElement("td",null,l.createElement(a,{type:"font",version:n})))))}},51464:function(e,n,t){t.r(n),t.d(n,{frontMatter:function(){return c},contentTitle:function(){return p},metadata:function(){return s},toc:function(){return u},default:function(){return d}});var l=t(87462),a=t(63366),i=(t(67294),t(3905)),r=t(82660),o=["components"],c={id:"changelog-v1.13.11",title:"v1.13.11"},p=void 0,s={unversionedId:"changelog/changelog-v1.13.11",id:"changelog/changelog-v1.13.11",title:"v1.13.11",description:"1. 发布情况",source:"@site/docs/changelog/changelog-v1.13.11.mdx",sourceDirName:"changelog",slug:"/changelog/changelog-v1.13.11",permalink:"/intellisense-form-website/docs/changelog/changelog-v1.13.11",tags:[],version:"current",frontMatter:{id:"changelog-v1.13.11",title:"v1.13.11"},sidebar:"someSidebar",previous:{title:"v1.13.12",permalink:"/intellisense-form-website/docs/changelog/changelog-v1.13.12"},next:{title:"v1.13.10",permalink:"/intellisense-form-website/docs/changelog/changelog-v1.13.10"}},u=[{value:"1. 发布情况",id:"1-发布情况",children:[],level:2},{value:"2. 平滑升级",id:"2-平滑升级",children:[],level:2},{value:"3. sinomatrix 依赖变更",id:"3-sinomatrix-依赖变更",children:[],level:2},{value:"4. 主要变更",id:"4-主要变更",children:[{value:"在页面上添加扩展脚本",id:"在页面上添加扩展脚本",children:[{value:"方式一：请求参数方式",id:"方式一请求参数方式",children:[],level:4},{value:"方式二：修改 index.html 文件的方式",id:"方式二修改-indexhtml-文件的方式",children:[],level:4}],level:3},{value:"指定扩展参数",id:"指定扩展参数",children:[{value:"请求参数",id:"请求参数",children:[],level:4},{value:"扩展脚本",id:"扩展脚本",children:[],level:4}],level:3},{value:"WebView 中嵌入表单页的退出",id:"webview-中嵌入表单页的退出",children:[{value:"方式一：使用回调函数的方式",id:"方式一使用回调函数的方式",children:[],level:4},{value:"方式二：使用 postMessage/onMessage 方式",id:"方式二使用-postmessageonmessage-方式",children:[],level:4}],level:3},{value:"WebView 中定制预览、下载文件",id:"webview-中定制预览下载文件",children:[{value:"请求参数方式示例",id:"请求参数方式示例",children:[],level:4},{value:"扩展脚本方式示例",id:"扩展脚本方式示例",children:[],level:4}],level:3}],level:2}],m={toc:u};function d(e){var n=e.components,t=(0,a.Z)(e,o);return(0,i.kt)("wrapper",(0,l.Z)({},m,t,{components:n,mdxType:"MDXLayout"}),(0,i.kt)("h2",{id:"1-发布情况"},"1. 发布情况"),(0,i.kt)("p",null,"发布日期：2022.2.20"),(0,i.kt)(r.Z,{version:"1.13.11",frontend:"1.13.11",backend:"1.13.9",font:"1.13.0",mdxType:"BundleList"}),(0,i.kt)("h2",{id:"2-平滑升级"},"2. 平滑升级"),(0,i.kt)("p",null,"可以从任何版本平滑升级到 v1.13.11。"),(0,i.kt)("h2",{id:"3-sinomatrix-依赖变更"},"3. sinomatrix 依赖变更"),(0,i.kt)("p",null,"因 sinomatrix 缺陷影响了智能表单之前版本（v1.12.0 版本之前的版本）提供的功能，sinomatrix 已经修复，所以需要同步升级 sinomatrix 到 ",(0,i.kt)("a",{parentName:"p",href:"http://47.93.34.153:10080/sino-matrix/sino-matrix/blob/master/CHANGELOG.md"},"1.6.37")," 。（注意：访问此地址时可能会出现 ERR_UNSAFE_PORT 的情况，请参看",(0,i.kt)("a",{parentName:"p",href:"https://blog.csdn.net/kjcxmx/article/details/118122483"},"这篇帖子"),"配置一下浏览器。）"),(0,i.kt)("h2",{id:"4-主要变更"},"4. 主要变更"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"improve(mobile): 新增退出应用回调函数",(0,i.kt)("a",{parentName:"li",href:"#%E6%8C%87%E5%AE%9A%E6%89%A9%E5%B1%95%E5%8F%82%E6%95%B0"},"扩展参数")," ",(0,i.kt)("inlineCode",{parentName:"li"},"exitAppCallback"),"，以支持 WebView 嵌入表单页时退出应用的行为定制"),(0,i.kt)("li",{parentName:"ul"},"improve(mobile): 在退出应用时通过 ",(0,i.kt)("inlineCode",{parentName:"li"},"window.postMessage")," 发送 ",(0,i.kt)("inlineCode",{parentName:"li"},"sinoform.EXIT_APP")," 消息，以改善 WebView 嵌入表单页时定制退出应用"),(0,i.kt)("li",{parentName:"ul"},"improve(mobile): 新增 ",(0,i.kt)("inlineCode",{parentName:"li"},"openFileCallback")," ",(0,i.kt)("a",{parentName:"li",href:"#%E6%8C%87%E5%AE%9A%E6%89%A9%E5%B1%95%E5%8F%82%E6%95%B0"},"扩展参数"),"，以支持定制 WebView 中预览、下载文件的行为"),(0,i.kt)("li",{parentName:"ul"},"improve(mobile): 新增 ",(0,i.kt)("inlineCode",{parentName:"li"},"extendScript")," ",(0,i.kt)("a",{parentName:"li",href:"#%E6%8C%87%E5%AE%9A%E6%89%A9%E5%B1%95%E5%8F%82%E6%95%B0"},"扩展参数"),"，添加扩展的脚本链接"),(0,i.kt)("li",{parentName:"ul"},"fix(form-fields): 修复部分复杂数据结构的表单字段必填校验失效的缺陷，包括单选按钮组、复选框组、部门选择、人员选择"),(0,i.kt)("li",{parentName:"ul"},"fix(flow-chart): 修复移动端切换页签时流程图提示框不消失的缺陷"),(0,i.kt)("li",{parentName:"ul"},"fix(flow-chart): 修复小尺寸流程图居中显示错误")),(0,i.kt)("h3",{id:"在页面上添加扩展脚本"},"在页面上添加扩展脚本"),(0,i.kt)("p",null,"智能表单支持在页面上添加扩展脚本。有两种方式：请求参数和修改 index.html 文件。"),(0,i.kt)("h4",{id:"方式一请求参数方式"},"方式一：请求参数方式"),(0,i.kt)("p",null,"可以通过请求参数 extendScript 添加扩展脚本。例如加载微信 jssdk 和 uni-app jssdk 以及自己写的扩展脚本："),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://res.wx.qq.com/open/js/jweixin-1.3.2.js"},"https://res.wx.qq.com/open/js/jweixin-1.3.2.js")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://js.cdn.aliyun.dcloud.net.cn/dev/uni-app/uni.webview.1.5.2.js"},"https://js.cdn.aliyun.dcloud.net.cn/dev/uni-app/uni.webview.1.5.2.js")),(0,i.kt)("li",{parentName:"ul"},"/custom-js-extend")),(0,i.kt)("p",null,"我们可以通过类似下面的代码来生成打开表单详情页的链接："),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-javascript"},'const extendScripts = [\n  "https://res.wx.qq.com/open/js/jweixin-1.3.2.js",\n  "https://js.cdn.aliyun.dcloud.net.cn/dev/uni-app/uni.webview.1.5.2.js",\n  "/custom-js-extend",\n];\nconst extendScriptParam = extendScripts\n  .map((url) => `extendScript=${encodeURIComponent(url)}`)\n  .join("&");\nconst baseDetailPageUrl =\n  "http://localhost:8082/intellisense-form-mobile/form/617103b0c9327f69ff45912b/detail?id=6171041bec2e2b2da2fefb95&workItemId=fe325768e2cd418e90b16eb5a36804e8";\nconst detailPageUrl = `${baseDetailPageUrl}&${extendScriptParam}`;\n')),(0,i.kt)("p",null,"建议采用类似 ",(0,i.kt)("a",{parentName:"p",href:"https://www.npmjs.com/package/qs"},"qs")," 这样的库来创建详情页链接，例如："),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-javascript"},'const extendScripts = [\n  "https://res.wx.qq.com/open/js/jweixin-1.3.2.js",\n  "https://js.cdn.aliyun.dcloud.net.cn/dev/uni-app/uni.webview.1.5.2.js",\n  "/custom-js-extend",\n];\nconst id = "6171041bec2e2b2da2fefb95";\nconst workItemId = "fe325768e2cd418e90b16eb5a36804e8";\nconst formId = "617103b0c9327f69ff45912b";\nconst params = {\n  extendScript: extendScripts,\n  id,\n  workItemId,\n};\nconst detailPageUrl = `http://localhost:8082/intellisense-form-mobile/form/${formId}/detail?${qs.stringify(\n  params\n)}`;\n')),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},"建议只指定一个扩展脚本链接，可以在扩展脚本加载其他的扩展脚本，例如下面的扩展脚本："),(0,i.kt)("pre",{parentName:"blockquote"},(0,i.kt)("code",{parentName:"pre",className:"language-javascript"},'function loadScript(url) {\n  const scriptElement = document.createElement("script");\n  scriptElement.type = "text/javascript";\n  scriptElement.src = url;\n  document.body.appendChild(scriptElement);\n}\n\nloadScript("https://res.wx.qq.com/open/js/jweixin-1.3.2.js");\nloadScript(\n  "https://js.cdn.aliyun.dcloud.net.cn/dev/uni-app/uni.webview.1.5.2.js"\n);\n'))),(0,i.kt)("h4",{id:"方式二修改-indexhtml-文件的方式"},"方式二：修改 index.html 文件的方式"),(0,i.kt)("p",null,"在智能表单前端包的根目录下包含了 ",(0,i.kt)("inlineCode",{parentName:"p"},"index.html")," 文件，可以收到调整，添加 ",(0,i.kt)("inlineCode",{parentName:"p"},"<script/>")," 标签。或者可以在网关级别上（如 spring cloud gateway、spring cloud zuul、nginx）动态添加 ",(0,i.kt)("inlineCode",{parentName:"p"},"<script/>")," 标签。"),(0,i.kt)("h3",{id:"指定扩展参数"},"指定扩展参数"),(0,i.kt)("p",null,"智能表单有很多扩展参数，app 可以通过该这些扩展参数来控制页面中一些行为。目前支持两种方式来指定扩展参数，即请求参数和扩展脚本。"),(0,i.kt)("h4",{id:"请求参数"},"请求参数"),(0,i.kt)("p",null,"在 WebView 中打开的页面链接上添加请求参数的方式，可以指定扩展参数。以 ",(0,i.kt)("inlineCode",{parentName:"p"},"exitAppCallback")," 扩展参数说明："),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-javascript"},'const exitAppCallback = "wx.miniProgram.navigateBack()";\nconst detailPageUrl = `http://localhost:8082/intellisense-form-mobile/form/617103b0c9327f69ff45912b/detail?id=6171041bec2e2b2da2fefb95&workItemId=fe325768e2cd418e90b16eb5a36804e8&exitAppCallback=${encodeURIComponent(\n  exitAppCallback\n)}`;\n')),(0,i.kt)("h4",{id:"扩展脚本"},"扩展脚本"),(0,i.kt)("p",null,"为了不让页面链接太长，可以使用扩展脚本的方式来实现"),(0,i.kt)("p",null,"智能表单支持通过在链接中添加",(0,i.kt)("strong",{parentName:"p"},"请求参数"),"来指定扩展参数，如 ",(0,i.kt)("inlineCode",{parentName:"p"},"exitAppCallback")," 和 ",(0,i.kt)("inlineCode",{parentName:"p"},"openFileCallback")," 请求参数。现在也支持在扩展脚本中直接指定扩展参数，如下所示："),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-javascript"},'// 指定退出应用的回调代码\nlocalStorage.setItem("exitAppCallback", "wx.miniProgram.navigateBack()");\n// 指定打开文件的回调代码\nlocalStorage.setItem("openFileCallback", "openFile");\n\n// 打开文件的方法\nfunction openFile(file) {\n  // 见下文的介绍\n}\n')),(0,i.kt)("h3",{id:"webview-中嵌入表单页的退出"},"WebView 中嵌入表单页的退出"),(0,i.kt)("p",null,"WebView 中嵌入表单页，在某些操作之后（例如发送成功后）需要从表单页退回到原生页面时，可以采用以下两种方式（需要应用中的 WebView 支持哪种方式）："),(0,i.kt)("h4",{id:"方式一使用回调函数的方式"},"方式一：使用回调函数的方式"),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},"本方式适合可以自定义 JavaScript 方法或者已经提供了退回 JavaScript 方法的 WebView。包括："),(0,i.kt)("p",{parentName:"blockquote"},"自定义退回 JavaScript 方法："),(0,i.kt)("ul",{parentName:"blockquote"},(0,i.kt)("li",{parentName:"ul"},"Android WebView"),(0,i.kt)("li",{parentName:"ul"},"ios WKWebView"),(0,i.kt)("li",{parentName:"ul"},"Flutter")),(0,i.kt)("p",{parentName:"blockquote"},"已经提供退回 JavaScript 方法："),(0,i.kt)("ul",{parentName:"blockquote"},(0,i.kt)("li",{parentName:"ul"},"微信小程序（包括通过 uni-app 开发的微信小程序）"))),(0,i.kt)("p",null,"通过 ",(0,i.kt)("inlineCode",{parentName:"p"},"exitAppCallback")," 扩展参数来指定退出应用的回调代码，例如："),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-javascript"},"const exitAppCallback = \"wx.miniProgram.navigateBack()\";\n// 或者\n// const exitAppCallback = 'uni.navigateBack()';\n")),(0,i.kt)("p",null,"以微信小程序并采用请求参数的方式为例："),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-javascript"},'// 模板\n<web-view src="{{url}}" />;\n\n// 设置页面url和退回回调代码\nconst pageUrl =\n  "http://localhost:8082/intellisense-form-mobile/form/617103b0c9327f69ff45912b/detail?id=6171041bec2e2b2da2fefb95&workItemId=fe325768e2cd418e90b16eb5a36804e8";\nconst exitAppCallback = "wx.miniProgram.navigateBack()";\n// 或者\n// const exitAppCallback = \'uni.navigateBack()\';\nthis.setData({\n  // 注意：需要编码 exitAppCallback\n  url: `${pageUrl}&exitAppCallback=${encodeURIComponent(exitAppCallback)}`,\n});\n')),(0,i.kt)("h4",{id:"方式二使用-postmessageonmessage-方式"},"方式二：使用 postMessage/onMessage 方式"),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},"本方式仅适合支持 postMessage/onMessage 方式进行通信的 webview。例如：react-native-webview，uni native webview（注意 uni-app 的小程序端别采用这种方案）等。")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-javascript"},'const pageUrl =\n  "http://localhost:8082/intellisense-form-mobile/form/617103b0c9327f69ff45912b/detail?id=6171041bec2e2b2da2fefb95&workItemId=fe325768e2cd418e90b16eb5a36804e8";\n<ReactNativeWebView\n  src={{ pageUrl }}\n  onMessage={(event) => {\n    console.log(event.nativeEvent.data); // 输出 sinoform.EXIT_APP\n  }}\n/>;\n')),(0,i.kt)("h3",{id:"webview-中定制预览下载文件"},"WebView 中定制预览、下载文件"),(0,i.kt)("p",null,"如果希望控制附件上传中的文件、图片预览和下载行为，可以通过扩展参数 ",(0,i.kt)("inlineCode",{parentName:"p"},"openFileCallback")," 来指定一个回调函数。例如在微信中查看图片："),(0,i.kt)("h4",{id:"请求参数方式示例"},"请求参数方式示例"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-javascript"},"// 模板\n<web-view src=\"{{url}}\" />;\n\n// 设置页面url和退回回调代码\nconst pageUrl =\n  \"http://localhost:8082/intellisense-form-mobile/form/617103b0c9327f69ff45912b/detail?id=6171041bec2e2b2da2fefb95&workItemId=fe325768e2cd418e90b16eb5a36804e8\";\nconst openFileCallback = `(file) => {\n  const isImage = ['jpg', 'jpeg', 'png'].includes(file.suffix.toLowerCase());\n  if (isImage) {\n    wx.previewImage({\n      current: file.url,\n      urls: [file.url]\n    });\n    // 返回 true 表示阻止内置的打开文件的行为\n    return true;\n  }\n  return false;\n}`;\nthis.setData({\n  // 注意：需要编码 openFileCallback\n  url: `${pageUrl}&exitAppCallback=${encodeURIComponent(openFileCallback)}`,\n});\n")),(0,i.kt)("p",null,"openFile 回调函数接受 file 对象，file 对象的示例如下："),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "id": "6210ff4cc9327f686b300c8c",\n  "title": "平台组线上支持制度.pdf",\n  "fileLength": 96106,\n  "suffix": "pdf",\n  "status": "success",\n  "url": "/apis/intellisense-form/files/6210ff4cc9327f686b300c8c"\n}\n')),(0,i.kt)("h4",{id:"扩展脚本方式示例"},"扩展脚本方式示例"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-javascript"},'function openFile(file) {\n  const isImage = ["jpg", "jpeg", "png"].includes(file.suffix.toLowerCase());\n  if (isImage) {\n    wx.previewImage({\n      current: file.url,\n      urls: [file.url],\n    });\n\n    // 返回 true 表示阻止内置的打开文件的行为\n    return true;\n  }\n\n  return false;\n}\n\n// 设定打开文件扩展参数\nlocalStorage.setItem("openFileCallback", "openFile");\n')))}d.isMDXComponent=!0}}]);