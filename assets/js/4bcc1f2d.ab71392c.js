"use strict";(self.webpackChunkintellisense_form_docs=self.webpackChunkintellisense_form_docs||[]).push([[6886],{3905:function(e,n,t){t.d(n,{Zo:function(){return p},kt:function(){return f}});var r=t(67294);function i(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function o(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function l(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?o(Object(t),!0).forEach((function(n){i(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function a(e,n){if(null==e)return{};var t,r,i=function(e,n){if(null==e)return{};var t,r,i={},o=Object.keys(e);for(r=0;r<o.length;r++)t=o[r],n.indexOf(t)>=0||(i[t]=e[t]);return i}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)t=o[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(i[t]=e[t])}return i}var c=r.createContext({}),u=function(e){var n=r.useContext(c),t=n;return e&&(t="function"==typeof e?e(n):l(l({},n),e)),t},p=function(e){var n=u(e.components);return r.createElement(c.Provider,{value:n},e.children)},s={inlineCode:"code",wrapper:function(e){var n=e.children;return r.createElement(r.Fragment,{},n)}},d=r.forwardRef((function(e,n){var t=e.components,i=e.mdxType,o=e.originalType,c=e.parentName,p=a(e,["components","mdxType","originalType","parentName"]),d=u(t),f=i,m=d["".concat(c,".").concat(f)]||d[f]||s[f]||o;return t?r.createElement(m,l(l({ref:n},p),{},{components:t})):r.createElement(m,l({ref:n},p))}));function f(e,n){var t=arguments,i=n&&n.mdxType;if("string"==typeof e||i){var o=t.length,l=new Array(o);l[0]=d;var a={};for(var c in n)hasOwnProperty.call(n,c)&&(a[c]=n[c]);a.originalType=e,a.mdxType="string"==typeof e?e:i,l[1]=a;for(var u=2;u<o;u++)l[u]=t[u];return r.createElement.apply(null,l)}return r.createElement.apply(null,t)}d.displayName="MDXCreateElement"},36708:function(e,n,t){t.r(n),t.d(n,{frontMatter:function(){return a},contentTitle:function(){return c},metadata:function(){return u},toc:function(){return p},default:function(){return d}});var r=t(87462),i=t(63366),o=(t(67294),t(3905)),l=["components"],a={id:"config-oauth2-login",title:"OAuth2单点登录集成配置"},c=void 0,u={unversionedId:"config-oauth2-login",id:"config-oauth2-login",title:"OAuth2单点登录集成配置",description:"首发版本",source:"@site/docs/config-oauth2-login.md",sourceDirName:".",slug:"/config-oauth2-login",permalink:"/intellisense-form-website/docs/config-oauth2-login",tags:[],version:"current",frontMatter:{id:"config-oauth2-login",title:"OAuth2单点登录集成配置"},sidebar:"someSidebar",previous:{title:"CAS 单点登录集成配置",permalink:"/intellisense-form-website/docs/config-cas-login"},next:{title:"仪表盘统计引擎配置",permalink:"/intellisense-form-website/docs/config-dashboard-engine"}},p=[{value:"首发版本",id:"首发版本",children:[],level:2},{value:"开启 OAuth2 客户端",id:"开启-oauth2-客户端",children:[{value:"单机版",id:"单机版",children:[],level:3},{value:"集群版",id:"集群版",children:[],level:3}],level:2},{value:"实现效果",id:"实现效果",children:[],level:2}],s={toc:p};function d(e){var n=e.components,t=(0,i.Z)(e,l);return(0,o.kt)("wrapper",(0,r.Z)({},s,t,{components:n,mdxType:"MDXLayout"}),(0,o.kt)("h2",{id:"首发版本"},"首发版本"),(0,o.kt)("p",null,"1.17.0"),(0,o.kt)("h2",{id:"开启-oauth2-客户端"},"开启 OAuth2 客户端"),(0,o.kt)("h3",{id:"单机版"},"单机版"),(0,o.kt)("p",null,"在 application.yml 文件中添加以下配置："),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml"},'spring:\n  security:\n    oauth2:\n      client:\n        registration:\n          # 注册客户端ID，客户端自定义\n          form-client-oidc: \n            # 自定义， 与spring.security.oauth2.client.provider 保持一致即可\n            provider: my-provider\n            # 认证服务端注册后提供\n            client-id: form-client \n            # 认证服务提供\n            client-secret: secret \n            # 认证授权类型（授权码）\n            authorization-grant-type: authorization_code  \n            redirect-uri: "http://127.0.0.1/apis/intellisense-form/oauth2/login/code/{registrationId}"\n            # 客户端申请注册的权限范围（逗号分隔）,认证服务提供\n            scope: openid,profile\n            # 客户端名称，自定义\n            client-name: form-client \n        provider:\n          my-provider:\n            # 认证服务器地址\n            issuer-uri: http://localhost:9000\n\n# oauth2 需要忽略验证的 url\nsinoform:\n  public-paths:\n    - /apis/intellisense-form/common/**\n    - /apis/intellisense-form/login\n    - /apis/intellisense-form/files/**\n    - /apis/intellisense-form/theme/**\n    - /apis/intellisense-form/plugIn/**\n')),(0,o.kt)("p",null,"配置说明："),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"redirect-uri"),"：重定向",(0,o.kt)("inlineCode",{parentName:"li"},"uri"),"，",(0,o.kt)("inlineCode",{parentName:"li"},"ip"),"部分为智能表单访问",(0,o.kt)("inlineCode",{parentName:"li"},"ip"),"，后面的",(0,o.kt)("inlineCode",{parentName:"li"},"/apis/intellisense-form/oauth2/login/code/{registrationId}"),"保持不变。这个配置需要提供给",(0,o.kt)("strong",{parentName:"li"},"OAuth2认证服务器"),"。其中",(0,o.kt)("inlineCode",{parentName:"li"},"{registrationId}"),"即为",(0,o.kt)("inlineCode",{parentName:"li"},"form-client-oidc"),"。也就是最终提供给认证服务器的地址为：",(0,o.kt)("inlineCode",{parentName:"li"},"http://ip/apis/intellisense-form/oauth2/login/code/form-client-oidc"),"。")),(0,o.kt)("h3",{id:"集群版"},"集群版"),(0,o.kt)("p",null,"如果部署多个智能表单后端服务，除上述配置外，还需要添加以下配置："),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml"},"spring:\n  redis:\n    # 基本连接信息配置\n    database: 0\n    host: 192.168.90.125\n    port: 6379\n    password: 123456\n    # 连接池信息配置\n    lettuce:\n      pool:\n        #连接池最大连接数（使用负值表示没有限制） 默认 8\n        max-active: 50\n        #连接池中的最大空闲连接 默认 8\n        max-idle: 8\n        #连接池中的最小空闲连接 默认 0\n        min-idle: 0\n")),(0,o.kt)("h2",{id:"实现效果"},"实现效果"),(0,o.kt)("p",null,"未登录时，访问后端接口会返回 401 错误，错误内容如下："),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "redirectUrl": "OAuth2认证服务器授权请求URL",\n  "type": "oauth2"\n}\n')),(0,o.kt)("p",null,"前端拿到该 URL后，直接重定向到该URL即可。"),(0,o.kt)("p",null,"此时，会跳转到认证服务器的登录页面，登录之后，可能会出现是否确认授权的页面（根据认证服务器配置不同，可能不需要确认），确认授权后，跳转回智能表单页面。"))}d.isMDXComponent=!0}}]);