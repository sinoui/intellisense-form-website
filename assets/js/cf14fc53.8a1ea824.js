"use strict";(self.webpackChunkintellisense_form_docs=self.webpackChunkintellisense_form_docs||[]).push([[9435],{58032:function(e,t,n){n.d(t,{N:function(){return u},Z:function(){return c}});var a=n(63366),r=n(87462),i=n(67294),l=n(86010),o=n(97325),s=n(35242),d="anchorWithStickyNavbar_31ik",p="anchorWithHideOnScrollNavbar_3R7-",m=["id"],u=function(e){var t=Object.assign({},e);return i.createElement("header",null,i.createElement("h1",(0,r.Z)({},t,{id:void 0}),t.children))},c=function(e){return"h1"===e?u:(t=e,function(e){var n,u=e.id,c=(0,a.Z)(e,m),E=(0,s.LU)().navbar.hideOnScroll;return u?i.createElement(t,(0,r.Z)({},c,{className:(0,l.Z)("anchor",(n={},n[p]=E,n[d]=!E,n)),id:u}),c.children,i.createElement("a",{className:"hash-link",href:"#"+u,title:(0,o.I)({id:"theme.common.headingLinkTitle",message:"Direct link to heading",description:"Title for link to heading"})},"​")):i.createElement(t,c)});var t}},98448:function(e,t,n){var a=n(67294);t.Z=function(e){var t=e.children,n=e.hidden,r=e.className;return a.createElement("div",{role:"tabpanel",hidden:n,className:r},t)}},97225:function(e,t,n){n.d(t,{Z:function(){return u}});var a=n(87462),r=n(67294),i=n(51048),l=n(22713);var o=function(){var e=(0,r.useContext)(l.Z);if(null==e)throw new Error('"useUserPreferencesContext" is used outside of "Layout" component.');return e},s=n(35242),d=n(86010),p="tabItem_1uMI";function m(e){var t,n,i,l=e.lazy,m=e.block,u=e.defaultValue,c=e.values,E=e.groupId,k=e.className,N=r.Children.map(e.children,(function(e){if((0,r.isValidElement)(e)&&void 0!==e.props.value)return e;throw new Error("Docusaurus error: Bad <Tabs> child <"+("string"==typeof e.type?e.type:e.type.name)+'>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.')})),g=null!=c?c:N.map((function(e){var t=e.props;return{value:t.value,label:t.label,attributes:t.attributes}})),f=(0,s.lx)(g,(function(e,t){return e.value===t.value}));if(f.length>0)throw new Error('Docusaurus error: Duplicate values "'+f.map((function(e){return e.value})).join(", ")+'" found in <Tabs>. Every value needs to be unique.');var h=null===u?u:null!=(t=null!=u?u:null==(n=N.find((function(e){return e.props.default})))?void 0:n.props.value)?t:null==(i=N[0])?void 0:i.props.value;if(null!==h&&!g.some((function(e){return e.value===h})))throw new Error('Docusaurus error: The <Tabs> has a defaultValue "'+h+'" but none of its children has the corresponding value. Available values are: '+g.map((function(e){return e.value})).join(", ")+". If you intend to show no default tab, use defaultValue={null} instead.");var v=o(),A=v.tabGroupChoices,b=v.setTabGroupChoices,w=(0,r.useState)(h),y=w[0],C=w[1],I=[],x=(0,s.o5)().blockElementScrollPositionUntilNextRender;if(null!=E){var B=A[E];null!=B&&B!==y&&g.some((function(e){return e.value===B}))&&C(B)}var F=function(e){var t=e.currentTarget,n=I.indexOf(t),a=g[n].value;a!==y&&(x(t),C(a),null!=E&&b(E,a))},S=function(e){var t,n=null;switch(e.key){case"ArrowRight":var a=I.indexOf(e.currentTarget)+1;n=I[a]||I[0];break;case"ArrowLeft":var r=I.indexOf(e.currentTarget)-1;n=I[r]||I[I.length-1]}null==(t=n)||t.focus()};return r.createElement("div",{className:"tabs-container"},r.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,d.Z)("tabs",{"tabs--block":m},k)},g.map((function(e){var t=e.value,n=e.label,i=e.attributes;return r.createElement("li",(0,a.Z)({role:"tab",tabIndex:y===t?0:-1,"aria-selected":y===t,key:t,ref:function(e){return I.push(e)},onKeyDown:S,onFocus:F,onClick:F},i,{className:(0,d.Z)("tabs__item",p,null==i?void 0:i.className,{"tabs__item--active":y===t})}),null!=n?n:t)}))),l?(0,r.cloneElement)(N.filter((function(e){return e.props.value===y}))[0],{className:"margin-vert--md"}):r.createElement("div",{className:"margin-vert--md"},N.map((function(e,t){return(0,r.cloneElement)(e,{key:t,hidden:e.props.value!==y})}))))}function u(e){var t=(0,i.Z)();return r.createElement(m,(0,a.Z)({key:String(t)},e))}},10003:function(e,t,n){n.r(t),n.d(t,{contentTitle:function(){return N},default:function(){return v},frontMatter:function(){return k},metadata:function(){return g},toc:function(){return f}});var a=n(87462),r=n(63366),i=n(67294),l=n(3905),o=n(77446),s=n(58032),d={h2:(0,s.Z)("h2"),h3:(0,s.Z)("h3"),h4:(0,s.Z)("h4"),h5:(0,s.Z)("h5"),h6:(0,s.Z)("h6")};function p(e){var t=e.children,n=e.as,a=void 0===n?"h3":n,r=e.id,l=d[a];return i.createElement(l,{id:r},t)}var m=function(e){var t=e.name,n=e.title,a=e.description,r=e.method,l=void 0===r?"GET":r,s=e.requestParams,d=e.successExample,m=e.children,u=e.errorExample,c=void 0===u?{status:"0",msg:"响应失败"}:u,E=n.toLocaleLowerCase().replace(/[ .]+/g,"-");return i.createElement(i.Fragment,null,i.createElement(p,{id:E},n),a&&i.createElement("p",null,a),i.createElement(p,{as:"h4",id:E+"-配置项"},"配置项"),i.createElement("code",null,"url.",t),i.createElement(p,{as:"h4",id:E+"-请求方法"},"请求方法"),i.createElement("p",null,i.createElement("code",null,l)),s&&s.length>0&&i.createElement(i.Fragment,null,i.createElement(p,{as:"h4",id:E+"-请求参数"},"请求参数"),i.createElement("ul",null,s.map((function(e){return i.createElement("li",{key:e.name},i.createElement("code",null,e.name)," - ",e.message)})))),i.createElement(p,{as:"h4",id:E+"-接口响应"},"接口响应"),i.createElement("p",null,"需要以 ",i.createElement("code",null,"application/json")," 格式返回以下格式的信息："),i.createElement(o.Z,{className:"language-json"},JSON.stringify(d,null,2)),m,i.createElement("p",null,"如果获取失败，可以返回以下格式的信息："),i.createElement(o.Z,{className:"language-json"},JSON.stringify(c,null,2)))},u=n(97225),c=n(98448),E=["components"],k={id:"config-user-info",title:"用户信息"},N=void 0,g={unversionedId:"config-user-info",id:"config-user-info",title:"用户信息",description:"本文介绍如何定制智能表单获取登录用户信息。要点如下：",source:"@site/docs/config-user-info.mdx",sourceDirName:".",slug:"/config-user-info",permalink:"/intellisense-form-website/docs/config-user-info",tags:[],version:"current",frontMatter:{id:"config-user-info",title:"用户信息"},sidebar:"someSidebar",previous:{title:"应用下资源迁移",permalink:"/intellisense-form-website/docs/config-move-form-to-application"},next:{title:"nginx的location匹配规则",permalink:"/intellisense-form-website/docs/nginx-location"}},f=[{value:"1. 定制获取登录用户信息",id:"1-定制获取登录用户信息",children:[],level:2},{value:"2. 优化接口性能",id:"2-优化接口性能",children:[],level:2},{value:"3. 获取登录用户信息",id:"3-获取登录用户信息",children:[{value:"从请求中识别当前用户 id",id:"从请求中识别当前用户-id",children:[],level:3},{value:"接口响应",id:"接口响应",children:[],level:3}],level:2},{value:"4. 由业务系统控制当前会话用户",id:"4-由业务系统控制当前会话用户",children:[],level:2},{value:"5. 切换当前用户所属部门",id:"5-切换当前用户所属部门",children:[{value:"5.1. <code>sinoform-current-dept-id</code> cookie",id:"51-sinoform-current-dept-id-cookie",children:[],level:3},{value:"5.2. 更换 <code>sinoform-current-dept-id</code> cookie 名称",id:"52-更换-sinoform-current-dept-id-cookie-名称",children:[],level:3},{value:"5.3. 查看 cookie 值",id:"53-查看-cookie-值",children:[],level:3}],level:2}],h={toc:f};function v(e){var t=e.components,i=(0,r.Z)(e,E);return(0,l.kt)("wrapper",(0,a.Z)({},h,i,{components:t,mdxType:"MDXLayout"}),(0,l.kt)("p",null,"本文介绍如何定制智能表单获取登录用户信息。要点如下："),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#1-%E5%AE%9A%E5%88%B6%E8%8E%B7%E5%8F%96%E7%99%BB%E5%BD%95%E7%94%A8%E6%88%B7%E4%BF%A1%E6%81%AF"},"1. 定制获取登录用户信息")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#2-%E4%BC%98%E5%8C%96%E6%8E%A5%E5%8F%A3%E6%80%A7%E8%83%BD"},"2. 优化获取登录用户信息的性能"))),(0,l.kt)("h2",{id:"1-定制获取登录用户信息"},"1. 定制获取登录用户信息"),(0,l.kt)("blockquote",null,(0,l.kt)("p",{parentName:"blockquote"},"支持版本：v1.10.0")),(0,l.kt)("p",null,"智能表单默认从 sino-matrix 中的 uias 服务中读取登录用户信息。如果您需要从第三方服务中读取登录用户信息，则需要在 ",(0,l.kt)("inlineCode",{parentName:"p"},"application.yml")," 中定制以下接口："),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-yaml",metastring:"config/application.yml","config/application.yml":!0},"url:\n  # 指定自定义的获取用户基本信息接口\n  get-user-info-by-id-url: http://localhost:8888/apis/get-user-info-by-id\n  # 指定自定义的获取指定用户所属的所有部门信息接口（如果是一人多部门，则返回所有的部门即可）\n  get-all-dept-by-user-id: http://localhost:8888/apis/get-all-dept-by-user-id\n  # 指定自定义的获取用户所具有的业务角色接口\n  get-flow-roles-by-id: http://localhost:8888/apis/get-flow-roles-by-id\n  # 指定自定义的获取指定部门的部门信息接口\n  get-dept-info-by-dept-id: http://localhost:8888/apis/get-dept-info-by-dept-id\n  # 指定自定义的获取指定部门所有上级部门信息接口\n  get-all-super-dept-by-id: http://localhost:8888/apis/get-all-super-dept-by-id\n  # 指定自定义的获取用户基本信息的接口（仅当集成 cas 单点登录时，需要配置并实现此接口）\n  get-user-info-by-name-url: http://localhost:8888/apis/get-user-info-by-name\n")),(0,l.kt)("p",null,"下面分章节介绍每一个接口。"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#1-1-%E8%8E%B7%E5%8F%96%E7%94%A8%E6%88%B7%E5%9F%BA%E6%9C%AC%E4%BF%A1%E6%81%AF%E6%8E%A5%E5%8F%A3"},"1.1. 获取用户基本信息接口")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#1-2-%E8%8E%B7%E5%8F%96%E7%94%A8%E6%88%B7%E6%89%80%E5%85%B7%E6%9C%89%E7%9A%84%E4%B8%9A%E5%8A%A1%E8%A7%92%E8%89%B2%E6%8E%A5%E5%8F%A3"},"1.2. 获取用户所具有的业务角色接口")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#1-3-%E8%8E%B7%E5%8F%96%E7%94%A8%E6%88%B7%E6%89%80%E5%B1%9E%E9%83%A8%E9%97%A8%E4%BF%A1%E6%81%AF%E6%8E%A5%E5%8F%A3"},"1.3. 获取用户所属部门信息接口")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#1-4-%E8%8E%B7%E5%8F%96%E6%8C%87%E5%AE%9A%E9%83%A8%E9%97%A8%E7%9A%84%E9%83%A8%E9%97%A8%E4%BF%A1%E6%81%AF%E6%8E%A5%E5%8F%A3"},"1.4. 获取指定部门的部门信息接口")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#1-5-%E8%8E%B7%E5%8F%96%E6%8C%87%E5%AE%9A%E9%83%A8%E9%97%A8%E7%9A%84%E6%89%80%E6%9C%89%E4%B8%8A%E7%BA%A7%E9%83%A8%E9%97%A8%E6%8E%A5%E5%8F%A3"},"1.5. 获取指定部门的所有上级部门接口")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#1-6-%E6%A0%B9%E6%8D%AE%E7%94%A8%E6%88%B7%E5%90%8D%E8%8E%B7%E5%8F%96%E7%94%A8%E6%88%B7%E5%9F%BA%E6%9C%AC%E4%BF%A1%E6%81%AF%E6%8E%A5%E5%8F%A3"},"1.6. 根据用户名获取用户基本信息接口"))),(0,l.kt)(m,{title:"1.1. 获取用户基本信息接口",name:"get-user-info-by-id-url",requestParams:[{name:"uid",message:"用户 id"}],successExample:{status:"1",msg:"获取用户信息成功",userInfo:{uid:"用户编号",userFullName:"用户姓名",phone:"电话号码"}},errorExample:{status:"0",msg:"用户不存在"},mdxType:"Api"}),(0,l.kt)(m,{title:"1.2. 获取用户所具有的业务角色接口",name:"get-flow-roles-by-id",requestParams:[{name:"userId",message:"用户 id"}],successExample:{status:"1",msg:"获取用户所具有的业务角色信息成功",rolesInfo:[{rolesId:"业务角色编号1",rolesName:"业务角色名称1"},{rolesId:"业务角色编号2",rolesName:"业务角色名称2"}]},errorExample:{status:"0",msg:"用户不存在"},mdxType:"Api"}),(0,l.kt)(m,{title:"1.3. 获取用户所属部门信息接口",name:"get-all-dept-by-user-id",requestParams:[{name:"userId",message:"用户 id"}],successExample:{status:"1",msg:"获取用户所属部门信息成功",deptInfo:[{deptid:"部门编号1",deptname:"部门名称1"},{deptid:"部门编号2",deptname:"部门名称2"}]},errorExample:{status:"0",msg:"用户不存在"},mdxType:"Api"},(0,l.kt)("div",{className:"admonition admonition-warning alert alert--danger"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"}))),"注意")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("p",{parentName:"div"},"请注意大小写。",(0,l.kt)("inlineCode",{parentName:"p"},"deptid")," 和 ",(0,l.kt)("inlineCode",{parentName:"p"},"deptname")," 属性名都是小写的。"))),(0,l.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"提示")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("p",{parentName:"div"},"对于一人多部门的情况，智能表单会认为此接口响应的第一个部门是默认部门。")))),(0,l.kt)(m,{title:"1.4. 获取指定部门的部门信息接口",name:"get-dept-info-by-dept-id",requestParams:[{name:"deptId",message:"部门 id"}],successExample:{status:"1",msg:"获取部门信息成功",deptInfo:[{deptid:"部门编号1",deptname:"部门名称1"}]},errorExample:{status:"0",msg:"部门不存在"},mdxType:"Api"},(0,l.kt)("div",{className:"admonition admonition-warning alert alert--danger"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"}))),"注意")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("p",{parentName:"div"},"请注意，",(0,l.kt)("inlineCode",{parentName:"p"},"deptInfo")," 是一个对象数组。")))),(0,l.kt)(m,{title:"1.5. 获取指定部门的所有上级部门接口",name:"get-all-super-dept-by-id",requestParams:[{name:"deptId",message:"部门 id"}],successExample:{status:"1",msg:"获取上级部门信息成功",deptInfo:[{deptid:"一级部门编号",deptname:"xx集团",treeId:"001"},{deptid:"二级部门编号",deptname:"xx子公司",treeId:"001001"},{deptid:"三级部门编号",deptname:"xx处室",treeId:"001001003"}]},errorExample:{status:"0",msg:"部门不存在"},mdxType:"Api"},(0,l.kt)(m,{title:"1.6. 根据用户名获取用户基本信息接口",name:"get-user-info-by-name-url",requestParams:[{name:"uName",message:"用户名"}],successExample:{status:"1",msg:"获取用户信息成功",userInfo:{uid:"用户编号",userFullName:"用户姓名",phone:"电话号码"}},errorExample:{status:"0",msg:"用户不存在"},mdxType:"Api"}),(0,l.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"提示")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("p",{parentName:"div"},"智能表单使用此接口主要用于两个方面："),(0,l.kt)("ul",{parentName:"div"},(0,l.kt)("li",{parentName:"ul"},"表单导航资源和数据的权限判定（例如部门领导能够查询到本部门以及下属部门的表单数据）"),(0,l.kt)("li",{parentName:"ul"},"显示完整的部门信息（例如表单数据创建人所在部门信息）")))),(0,l.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"关于 treeId")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("p",{parentName:"div"},"智能表单会根据 ",(0,l.kt)("inlineCode",{parentName:"p"},"treeId")," 的位数识别部门级别，",(0,l.kt)("strong",{parentName:"p"},"位数"),"越少，级别越高。"),(0,l.kt)("p",{parentName:"div"},"可以不返回 ",(0,l.kt)("inlineCode",{parentName:"p"},"treeId"),"，则返回的部门数组",(0,l.kt)("strong",{parentName:"p"},"必须"),"是从上级到下级排序的。")))),(0,l.kt)("h2",{id:"2-优化接口性能"},"2. 优化接口性能"),(0,l.kt)("blockquote",null,(0,l.kt)("p",{parentName:"blockquote"},"支持版本：1.12.4")),(0,l.kt)("p",null,"智能表单后端没有维护会话状态（",(0,l.kt)("inlineCode",{parentName:"p"},"session"),"），所以在需要获取当前用户信息时，都是调用接口来获取的。为了良好的性能，智能表单实现了接口响应的缓存功能。每个接口的缓存时长都是可以定制的。接口的默认缓存时长和对应的缓存时长配置项如下表所示："),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"接口"),(0,l.kt)("th",{parentName:"tr",align:null},"缓存时长"),(0,l.kt)("th",{parentName:"tr",align:null},"缓存时长配置项"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"get-user-info-by-id-url"),(0,l.kt)("td",{parentName:"tr",align:null},"30 分钟"),(0,l.kt)("td",{parentName:"tr",align:null},"sinoform.user-cache-time")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"get-all-dept-by-user-id"),(0,l.kt)("td",{parentName:"tr",align:null},"30 分钟"),(0,l.kt)("td",{parentName:"tr",align:null},"sinoform.user-cache-time")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"get-flow-roles-by-id"),(0,l.kt)("td",{parentName:"tr",align:null},"5 分钟"),(0,l.kt)("td",{parentName:"tr",align:null},"sinoform.user-roles-cache-time")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"get-dept-info-by-dept-id"),(0,l.kt)("td",{parentName:"tr",align:null},"1 小时"),(0,l.kt)("td",{parentName:"tr",align:null},"sinoform.dept-cache-time")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"get-all-super-dept-by-id"),(0,l.kt)("td",{parentName:"tr",align:null},"1 小时"),(0,l.kt)("td",{parentName:"tr",align:null},"sinoform.dept-path-cache-time")))),(0,l.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"缓存时长单位")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("p",{parentName:"div"},"所有的缓存时长配置值的单位是 ",(0,l.kt)("inlineCode",{parentName:"p"},"毫秒"),"。"))),(0,l.kt)("p",null,"默认的缓存时长配置如下："),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-yaml",metastring:"application.yml","application.yml":!0},"sinoform:\n  # 用户信息缓存时长：30分钟（单位：毫秒）\n  user-cache-time: 1800000\n  # 用户对应的业务角色信息缓存时长：5分钟（单位：毫秒）\n  user-roles-cache-time: 300000\n  # 部门信息缓存时长：1小时（单位：毫秒）\n  dept-cache-time: 3600000\n  # 部门路径信息缓存时长：1小时（单位：毫秒）\n  dept-path-cache-time: 3600000\n")),(0,l.kt)("h2",{id:"3-获取登录用户信息"},"3. 获取登录用户信息"),(0,l.kt)("p",null,"智能表单服务提供获取登录用户信息的接口，如下所示："),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-http"},"GET http://<智能表单访问地址>/apis/intellisense-form/userInfo\n")),(0,l.kt)("h3",{id:"从请求中识别当前用户-id"},"从请求中识别当前用户 id"),(0,l.kt)("p",null,"通过以下两种方式识别当前用户的 id："),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"通过请求头 ",(0,l.kt)("inlineCode",{parentName:"li"},"sinoform-current-user-id"),"（一般由网关提供此请求头）"),(0,l.kt)("li",{parentName:"ul"},"通过请求 cookie ",(0,l.kt)("inlineCode",{parentName:"li"},"SSOID"))),(0,l.kt)("p",null,"方式一适合通过可编程网关（如 spring-cloud-gateway）实现多系统共享 session 的方案，在网关上将当前用户 id 放入请求头 ",(0,l.kt)("inlineCode",{parentName:"p"},"sinoform-current-user-id")," 中。方式二适合使用 sinomatrix sso 实现多系统单点登录的情况。"),(0,l.kt)("h3",{id:"接口响应"},"接口响应"),(0,l.kt)("p",null,"此接口返回的内容如下："),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "userId": "4028d00e6f16845c016f79dda0c20231",\n  "userName": "张三",\n  "deptId": "4028d00e6ec96438016ec97b4b10000b",\n  "deptName": "处室一",\n  "roleIds": ["4028d00e7a6613f4017af154f7840454"],\n  "roleNames": ["处员"],\n  "deptInfo": [\n    "4028d00e6ec96438016ec97b4b10000b",\n    "4028d00e6ec96438016ec976fee20000",\n    "4028d00e6ec42073016ec4629a490001"\n  ],\n  "deptInfoName": ["处室一", "分公司", "集团"],\n  "allDeptIds": [\n    "4028d00e6ec96438016ec97b4b10000b",\n    "2128d00e6ed1df338016ec97b4b10000b"\n  ]\n}\n')),(0,l.kt)("p",null,"数据项的含义如下表所示："),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"属性名"),(0,l.kt)("th",{parentName:"tr",align:null},"说明"),(0,l.kt)("th",{parentName:"tr",align:null},"来源"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"userId"),(0,l.kt)("td",{parentName:"tr",align:null},"用户 id"),(0,l.kt)("td",{parentName:"tr",align:null},"从请求中获取")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"userName"),(0,l.kt)("td",{parentName:"tr",align:null},"用户信息"),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("a",{parentName:"td",href:"#1-1-%E8%8E%B7%E5%8F%96%E7%94%A8%E6%88%B7%E5%9F%BA%E6%9C%AC%E4%BF%A1%E6%81%AF%E6%8E%A5%E5%8F%A3"},"get-user-info-by-id-url")," 中的 ",(0,l.kt)("inlineCode",{parentName:"td"},"userName")," 属性")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"deptId"),(0,l.kt)("td",{parentName:"tr",align:null},"所属部门 id"),(0,l.kt)("td",{parentName:"tr",align:null},"如果有请求头 ",(0,l.kt)("inlineCode",{parentName:"td"},"sinoform-current-dept-id"),"，则为之；否则等于 ",(0,l.kt)("a",{parentName:"td",href:"#1-3-%E8%8E%B7%E5%8F%96%E7%94%A8%E6%88%B7%E6%89%80%E5%B1%9E%E9%83%A8%E9%97%A8%E4%BF%A1%E6%81%AF%E6%8E%A5%E5%8F%A3"},"get-all-dept-by-user-id")," 第一条数据的 ",(0,l.kt)("inlineCode",{parentName:"td"},"deptId"))),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"deptName"),(0,l.kt)("td",{parentName:"tr",align:null},"所属部门名称"),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("a",{parentName:"td",href:"#1-4-%E8%8E%B7%E5%8F%96%E6%8C%87%E5%AE%9A%E9%83%A8%E9%97%A8%E7%9A%84%E9%83%A8%E9%97%A8%E4%BF%A1%E6%81%AF%E6%8E%A5%E5%8F%A3"},"get-dept-info-by-dept-id")," 中的 ",(0,l.kt)("inlineCode",{parentName:"td"},"deptname")," 属性")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"roleIds"),(0,l.kt)("td",{parentName:"tr",align:null},"用户拥有的业务角色 id"),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("a",{parentName:"td",href:"#1-2-%E8%8E%B7%E5%8F%96%E7%94%A8%E6%88%B7%E6%89%80%E5%85%B7%E6%9C%89%E7%9A%84%E4%B8%9A%E5%8A%A1%E8%A7%92%E8%89%B2%E6%8E%A5%E5%8F%A3"},"get-flow-roles-by-id")," 中的 ",(0,l.kt)("inlineCode",{parentName:"td"},"rolesId"))),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"roleNames"),(0,l.kt)("td",{parentName:"tr",align:null},"用户拥有的业务角色名称"),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("a",{parentName:"td",href:"#1-2-%E8%8E%B7%E5%8F%96%E7%94%A8%E6%88%B7%E6%89%80%E5%85%B7%E6%9C%89%E7%9A%84%E4%B8%9A%E5%8A%A1%E8%A7%92%E8%89%B2%E6%8E%A5%E5%8F%A3"},"get-flow-roles-by-id")," 中的 ",(0,l.kt)("inlineCode",{parentName:"td"},"rolesName"))),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"deptInfo"),(0,l.kt)("td",{parentName:"tr",align:null},"用户所属部门所有祖先部门 id（包含自身所属部门），即部门路径，从小到大排序，如 ",(0,l.kt)("inlineCode",{parentName:"td"},"处室一"),"、",(0,l.kt)("inlineCode",{parentName:"td"},"分公司"),"、",(0,l.kt)("inlineCode",{parentName:"td"},"集团")),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("a",{parentName:"td",href:"#1-5-%E8%8E%B7%E5%8F%96%E6%8C%87%E5%AE%9A%E9%83%A8%E9%97%A8%E7%9A%84%E6%89%80%E6%9C%89%E4%B8%8A%E7%BA%A7%E9%83%A8%E9%97%A8%E6%8E%A5%E5%8F%A3"},"get-all-super-dept-by-id")," 中的 ",(0,l.kt)("inlineCode",{parentName:"td"},"deptid"))),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"deptInfoName"),(0,l.kt)("td",{parentName:"tr",align:null},"用户所属部门所有祖先部门名称（包含自身所属部门），即部门路径，从小到大排序，如 ",(0,l.kt)("inlineCode",{parentName:"td"},"处室一"),"、",(0,l.kt)("inlineCode",{parentName:"td"},"分公司"),"、",(0,l.kt)("inlineCode",{parentName:"td"},"集团")),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("a",{parentName:"td",href:"#1-5-%E8%8E%B7%E5%8F%96%E6%8C%87%E5%AE%9A%E9%83%A8%E9%97%A8%E7%9A%84%E6%89%80%E6%9C%89%E4%B8%8A%E7%BA%A7%E9%83%A8%E9%97%A8%E6%8E%A5%E5%8F%A3"},"get-all-super-dept-by-id")," 中的 ",(0,l.kt)("inlineCode",{parentName:"td"},"deptname"))),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"allDeptIds"),(0,l.kt)("td",{parentName:"tr",align:null},"用户所有在职部门 id"),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("a",{parentName:"td",href:"#1-3-%E8%8E%B7%E5%8F%96%E7%94%A8%E6%88%B7%E6%89%80%E5%B1%9E%E9%83%A8%E9%97%A8%E4%BF%A1%E6%81%AF%E6%8E%A5%E5%8F%A3"},"get-all-dept-by-user-id")," 中的 ",(0,l.kt)("inlineCode",{parentName:"td"},"deptid"))))),(0,l.kt)("h2",{id:"4-由业务系统控制当前会话用户"},"4. 由业务系统控制当前会话用户"),(0,l.kt)("p",null,"业务系统可以通过可编程网关（如 spring cloud gateway）来告知智能表单当前会话用户（即登录用户）是谁，以及属于哪个部门（解决一人多岗的问题）。"),(0,l.kt)("p",null,"通过网关实现登录或者与第三方 SSO 集成后，获取到当前用户的 userId 和 deptId，然后通过 ",(0,l.kt)("inlineCode",{parentName:"p"},"sinoform-current-user-id")," 和 ",(0,l.kt)("inlineCode",{parentName:"p"},"sinoform-current-dept-id")," 请求头告知智能表单即可。"),(0,l.kt)("p",null,"可以通过过滤器来实现，例如："),(0,l.kt)(u.Z,{mdxType:"Tabs"},(0,l.kt)(c.Z,{value:"zuul",label:"spring cloud zuul",mdxType:"TabItem"},(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'package com.sinosoft.sinoformgateway.filters;\n\nimport static org.springframework.cloud.netflix.zuul.filters.support.FilterConstants.PRE_DECORATION_FILTER_ORDER;\nimport static org.springframework.cloud.netflix.zuul.filters.support.FilterConstants.PRE_TYPE;\n\nimport com.netflix.zuul.ZuulFilter;\nimport com.netflix.zuul.context.RequestContext;\nimport java.util.Optional;\nimport javax.servlet.http.HttpServletRequest;\nimport javax.servlet.http.HttpSession;\nimport lombok.extern.slf4j.Slf4j;\nimport org.springframework.stereotype.Component;\n\n/**\n * 将会话用户信息同步到智能表单的过滤器\n */\n@Component\n@Slf4j\npublic class AuthFilter extends ZuulFilter {\n  private static final String USER_ID_HEAD_NAME = "sinoform-current-user-id";\n  private static final String DEPT_ID_HEAD_NAME = "sinoform-current-dept-id";\n\n  @Override\n  public String filterType() {\n    return PRE_TYPE;\n  }\n\n  @Override\n  public int filterOrder() {\n    return PRE_DECORATION_FILTER_ORDER - 1; //在 PreDecoration 阶段之前执行\n  }\n\n  @Override\n  public boolean shouldFilter() {\n    return true; // 每个请求都执行此过滤器（项目组可以根据实际情况，添加一些过滤逻辑）\n  }\n\n  @Override\n  public Object run() {\n    // 将登录用户的userId和deptId通过请求头的方式同步到智能表单\n    RequestContext ctx = RequestContext.getCurrentContext();\n    HttpSession httpSession = ctx.getRequest().getSession();\n\n    getUserInfoFromSession(httpSession).ifPresent(userInfo -> {\n      ctx.addZuulRequestHeader(USER_ID_HEAD_NAME, userInfo.getUserId());\n      ctx.addZuulRequestHeader(DEPT_ID_HEAD_NAME, userInfo.getDeptId());\n    });\n\n    return null;\n  }\n\n  private Optional<UserInfo> getUserInfoFromSession(HttpSession session) {\n    Object userInfo = session.getAttribute("user");\n\n    if (userInfo != null) {\n      return Optional.of((UserInfo)userInfo);\n    }\n\n    return Optional.empty();\n  }\n}\n'))),(0,l.kt)(c.Z,{value:"gateway",label:"spring cloud gateway",mdxType:"TabItem"},(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'package com.sinosoft.sinoformgatawaydemo.filters;\n\nimport com.sinosoft.sinoformgatawaydemo.model.UserInfo;\nimport java.util.Optional;\nimport lombok.extern.slf4j.Slf4j;\nimport org.springframework.cloud.gateway.filter.GatewayFilterChain;\nimport org.springframework.cloud.gateway.filter.GlobalFilter;\nimport org.springframework.core.Ordered;\nimport org.springframework.http.server.reactive.ServerHttpRequest;\nimport org.springframework.stereotype.Component;\nimport org.springframework.web.server.ServerWebExchange;\nimport org.springframework.web.server.WebSession;\nimport reactor.core.publisher.Mono;\n\n/**\n * 同步会话用户信息的过滤器\n */\n@Component\n@Slf4j\npublic class AuthFilter implements GlobalFilter, Ordered {\n  private static final String USER_ID_HEAD_NAME = "sinoform-current-user-id";\n  private static final String DEPT_ID_HEAD_NAME = "sinoform-current-dept-id";\n\n  @Override\n  public Mono<Void> filter(ServerWebExchange exchange, GatewayFilterChain chain) {\n    return exchange.getSession()\n        .map(this::getUserInfoFromSession)\n        .map(userInfoOptional ->\n            userInfoOptional\n                .map(userInfo -> addUserInfoHeaders(exchange, userInfo))\n                .orElse(exchange)\n        )\n        .flatMap(chain::filter);\n  }\n\n  /**\n   * 将用户信息添加到请求头中\n   * @param exchange 交换对象\n   * @param userInfo 用户信息\n   * @return 返回包含用户信息请求头的新的交换对象\n   */\n  public ServerWebExchange addUserInfoHeaders(ServerWebExchange exchange, UserInfo userInfo) {\n    ServerHttpRequest.Builder newRequestBuilder = exchange.getRequest().mutate();\n    ServerWebExchange.Builder newExchangeBuilder = exchange.mutate();\n\n    ServerHttpRequest newRequest = newRequestBuilder\n        .header(USER_ID_HEAD_NAME, userInfo.getUserId())\n        .header(DEPT_ID_HEAD_NAME, userInfo.getDeptId())\n        .build();\n\n    return newExchangeBuilder.request(newRequest).build();\n  }\n\n  /**\n   * 从 session 中获取用户信息\n   * @param webSession 会话对象\n   * @return 返回获取到的用户信息。如果没有用户信息，则返回空的Optional对象。\n   */\n  public Optional<UserInfo> getUserInfoFromSession(WebSession webSession) {\n    Object userInfo = webSession.getAttribute("user");\n    if (userInfo != null) {\n      return Optional.of((UserInfo)userInfo);\n    }\n    return Optional.empty();\n  }\n\n  @Override\n  public int getOrder() {\n    return 0;\n  }\n}\n')))),(0,l.kt)("p",null,"之前推荐项目组直接在网关中拦截并实现 ",(0,l.kt)("inlineCode",{parentName:"p"},"/apis/intellisense-form/common/userInfo")," 接口。如果采用过滤器方案，则不需要这么做，可以将网关中的此接口删除掉。"),(0,l.kt)("p",null,"注意：本示例是从 session 中获取当前用户信息的。项目组可以根据自身的情况，可以从不同的地方获取，例如第三方 SSO。"),(0,l.kt)("h2",{id:"5-切换当前用户所属部门"},"5. 切换当前用户所属部门"),(0,l.kt)("p",null,"如果一个用户属于多个部门，那么可以通过以下两种方式告知智能表单当前用户的所属部门，以支持一人多岗切换："),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"方式一：通过 ",(0,l.kt)("inlineCode",{parentName:"li"},"sinoform-current-dept-id")," 请求头告知智能表单（适合网关模式）"),(0,l.kt)("li",{parentName:"ul"},"方式二：通过 ",(0,l.kt)("inlineCode",{parentName:"li"},"sinoform-current-dept-id")," cookie 告知智能表单（适合共同使用 sinomatrix sso 的情况，前提是：业务系统与智能表单是同域名）")),(0,l.kt)("p",null,(0,l.kt)("a",{parentName:"p",href:"#4-%E7%94%B1%E4%B8%9A%E5%8A%A1%E7%B3%BB%E7%BB%9F%E6%8E%A7%E5%88%B6%E5%BD%93%E5%89%8D%E4%BC%9A%E8%AF%9D%E7%94%A8%E6%88%B7"},"第 4 章节"),"已经说明了方式一。本章节重点讲解方式二。"),(0,l.kt)("h3",{id:"51-sinoform-current-dept-id-cookie"},"5.1. ",(0,l.kt)("inlineCode",{parentName:"h3"},"sinoform-current-dept-id")," cookie"),(0,l.kt)("blockquote",null,(0,l.kt)("p",{parentName:"blockquote"},"最低版本要求："),(0,l.kt)("ul",{parentName:"blockquote"},(0,l.kt)("li",{parentName:"ul"},"1.13.15"),(0,l.kt)("li",{parentName:"ul"},"1.14.1"))),(0,l.kt)("p",null,"在业务系统切换当前用户所属部门时，可以将部门信息写入到 ",(0,l.kt)("inlineCode",{parentName:"p"},"sinoform-current-dept-id")," cookie 中，因为智能表单与业务系统是同域名的，所以智能表单也能接收到此 cookie。"),(0,l.kt)("div",{className:"admonition admonition-warning alert alert--danger"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"}))),"重要提示")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("p",{parentName:"div"},"此方式只适合智能表单和业务系统在同一个域名下的情况。"))),(0,l.kt)("h3",{id:"52-更换-sinoform-current-dept-id-cookie-名称"},"5.2. 更换 ",(0,l.kt)("inlineCode",{parentName:"h3"},"sinoform-current-dept-id")," cookie 名称"),(0,l.kt)("p",null,"当前用户所属部门 cookie 名称默认为 ",(0,l.kt)("inlineCode",{parentName:"p"},"sinoform-current-dept-id"),"，可以通过下面的配置项更改此默认名称："),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-yaml",metastring:'title="application.yaml"',title:'"application.yaml"'},"sinoform:\n  dept-id-cookie-name: custom-current-dept-id\n")),(0,l.kt)("h3",{id:"53-查看-cookie-值"},"5.3. 查看 cookie 值"),(0,l.kt)("p",null,"当你在集成时发现没有达到预期效果，那么需要查看一下 cookie 值是否正确。"),(0,l.kt)("div",{className:"admonition admonition-success alert alert--success"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"提示")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("p",{parentName:"div"},"当集成遇到问题，需要平台组协助时，请截取下面两张图并发给平台组同事。"))),(0,l.kt)("p",null,"可以打开 Chrome devtools，切换到应用页签，查看 cookie 值。如下图所示："),(0,l.kt)("p",null,(0,l.kt)("img",{src:n(2831).Z})),(0,l.kt)("p",null,"或者切换到网络页签，找到 /userInfo 接口，从请求头中查看 cookie 值。如下图所示："),(0,l.kt)("p",null,(0,l.kt)("img",{src:n(98808).Z})))}v.isMDXComponent=!0},2831:function(e,t,n){t.Z=n.p+"assets/images/view-cookie-in-app-06b7e3fc602e89842bd4cba44c0b8729.png"},98808:function(e,t,n){t.Z=n.p+"assets/images/view-cookie-network-dfea3ae33f64a2ab62a74991a69dee7f.png"}}]);