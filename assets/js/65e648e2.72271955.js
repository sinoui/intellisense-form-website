"use strict";(self.webpackChunkintellisense_form_docs=self.webpackChunkintellisense_form_docs||[]).push([[9751],{3905:function(e,n,t){t.d(n,{Zo:function(){return p},kt:function(){return u}});var a=t(67294);function i(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function r(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function l(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?r(Object(t),!0).forEach((function(n){i(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):r(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function o(e,n){if(null==e)return{};var t,a,i=function(e,n){if(null==e)return{};var t,a,i={},r=Object.keys(e);for(a=0;a<r.length;a++)t=r[a],n.indexOf(t)>=0||(i[t]=e[t]);return i}(e,n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)t=r[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(i[t]=e[t])}return i}var s=a.createContext({}),m=function(e){var n=a.useContext(s),t=n;return e&&(t="function"==typeof e?e(n):l(l({},n),e)),t},p=function(e){var n=m(e.components);return a.createElement(s.Provider,{value:n},e.children)},d={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},c=a.forwardRef((function(e,n){var t=e.components,i=e.mdxType,r=e.originalType,s=e.parentName,p=o(e,["components","mdxType","originalType","parentName"]),c=m(t),u=i,k=c["".concat(s,".").concat(u)]||c[u]||d[u]||r;return t?a.createElement(k,l(l({ref:n},p),{},{components:t})):a.createElement(k,l({ref:n},p))}));function u(e,n){var t=arguments,i=n&&n.mdxType;if("string"==typeof e||i){var r=t.length,l=new Array(r);l[0]=c;var o={};for(var s in n)hasOwnProperty.call(n,s)&&(o[s]=n[s]);o.originalType=e,o.mdxType="string"==typeof e?e:i,l[1]=o;for(var m=2;m<r;m++)l[m]=t[m];return a.createElement.apply(null,l)}return a.createElement.apply(null,t)}c.displayName="MDXCreateElement"},33:function(e,n,t){t.r(n),t.d(n,{frontMatter:function(){return o},contentTitle:function(){return s},metadata:function(){return m},toc:function(){return p},default:function(){return c}});var a=t(87462),i=t(63366),r=(t(67294),t(3905)),l=["components"],o={id:"helm-k8s",title:"部署智能表单(Helm)"},s=void 0,m={unversionedId:"dep-k8s/helm-k8s",id:"dep-k8s/helm-k8s",title:"部署智能表单(Helm)",description:"配置说明",source:"@site/docs/dep-k8s/3-helm-k8s.md",sourceDirName:"dep-k8s",slug:"/dep-k8s/helm-k8s",permalink:"/intellisense-form-website/docs/dep-k8s/helm-k8s",tags:[],version:"current",sidebarPosition:3,frontMatter:{id:"helm-k8s",title:"部署智能表单(Helm)"},sidebar:"someSidebar",previous:{title:"部署智能表单",permalink:"/intellisense-form-website/docs/dep-k8s/form-k8s"},next:{title:"部署 mongodb 集群（手动）",permalink:"/intellisense-form-website/docs/dep-k8s/mongo-cluster-k8s"}},p=[{value:"配置说明",id:"配置说明",children:[{value:"基本配置",id:"基本配置",children:[],level:3},{value:"后端服务启动配置文件",id:"后端服务启动配置文件",children:[{value:"自定义配置文件",id:"自定义配置文件",children:[],level:4},{value:"验证配置文件格式是否正确",id:"验证配置文件格式是否正确",children:[],level:4}],level:3}],level:2},{value:"部署智能表单",id:"部署智能表单",children:[{value:"安装 Chart",id:"安装-chart",children:[],level:3},{value:"访问",id:"访问",children:[],level:3}],level:2},{value:"卸载 Chart",id:"卸载-chart",children:[],level:2}],d={toc:p};function c(e){var n=e.components,t=(0,i.Z)(e,l);return(0,r.kt)("wrapper",(0,a.Z)({},d,t,{components:n,mdxType:"MDXLayout"}),(0,r.kt)("h2",{id:"配置说明"},"配置说明"),(0,r.kt)("h3",{id:"基本配置"},"基本配置"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml",metastring:"title=values.yaml",title:"values.yaml"},'# 镜像拉取策略（默认IfNotPresent）\n#imagePullPolicy: IfNotPresent\n\n# 应用副本数量（默认1）\n#replicaCount: 1\n\n# 前端服务配置\nweb:\n  {}\n  # 镜像仓库地址（默认阿里云仓库）\n#  image: registry.cn-hangzhou.aliyuncs.com/sinoform/sinoform-web\n# 镜像版本（默认latest）\n#  version:\n# 内存及CPU分配(没有默认值，为空的话不分配资源)\n#  memory: "128Mi"\n#  cpu: "500m"\n\n# 后端服务配置\nbackend:\n  {}\n  # 镜像仓库地址（默认阿里云仓库）\n#  image: registry.cn-hangzhou.aliyuncs.com/sinoform/sinoform-backend\n# 镜像版本（默认latest）\n#  version:\n# 内存及CPU分配(没有默认值，为空的话不分配资源)\n#  memory: "4096Mi"\n#  cpu: "2000m"\n\n# Ingress配置\ningress:\n  {}\n  # 访问域名（默认为空）\n#  host:\n\n####################################################\n#  config将作为智能表单后端服务的启动配置文件             #\n#  注意：无需指定端口号，使用默认值即可                   #\n####################################################\nconfig: {}\n')),(0,r.kt)("h3",{id:"后端服务启动配置文件"},"后端服务启动配置文件"),(0,r.kt)("p",null,"智能表单依赖 ",(0,r.kt)("inlineCode",{parentName:"p"},"MongoDB")," 和关系型数据库才能运行。所以需要准备智能表单的配置。作为智能表单后端服务的启动配置文件。"),(0,r.kt)("p",null,"将这部分配置写入",(0,r.kt)("inlineCode",{parentName:"p"},"values.yaml"),"中的",(0,r.kt)("inlineCode",{parentName:"p"},"config"),"配置下。"),(0,r.kt)("div",{className:"admonition admonition-warning alert alert--danger"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"}))),"warning")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"配置中",(0,r.kt)("strong",{parentName:"p"},"不可以"),"指定端口号，最终访问智能的端口号为",(0,r.kt)("inlineCode",{parentName:"p"},"nginx-ingress"),"的",(0,r.kt)("inlineCode",{parentName:"p"},"NodePort"),"，因此智能表单服务的端口号，对于用户没有意义。"),(0,r.kt)("p",{parentName:"div"},"配置内容不仅限下面示例中的配置，只要是智能表单可配置的支持的配置项，均可写入文件。"))),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml",metastring:"title=values.yaml",title:"values.yaml"},"####################################################\n#  此文件将作为智能表单后端服务的启动配置文件              #\n#  注意：无需指定端口号，使用默认值即可                   #\n####################################################\nconfig:\n  # 指定spring.datasource数据库类型（>=1.15.0版本可省略）\n  database:\n    type: mysql\n\n  spring:\n    data:\n      # 智能表单mongodb数据库配置\n      mongodb:\n        uri: mongodb://192.168.90.128:27017/form?waitQueueMultiple=1000\n    # 智能表单业务库配置\n    datasource:\n      url: jdbc:mysql://192.168.90.128:3306/form?serverTimezone=UTC&useUnicode=true&characterEncoding=UTF-8&allowMultiQueries=true&useSSL=false&allowPublicKeyRetrieval=true\n      username: form\n      password: form\n      driver-class-name: com.mysql.cj.jdbc.Driver\n      druid:\n        # 指定测试数据库连接的连通性 SQL 语句\n        validation-query: select 1\n\n  sinomatrix:\n    datasource:\n      url: jdbc:mysql://192.168.90.128:3306/sinoepuias?serverTimezone=UTC&useUnicode=true&characterEncoding=UTF-8&allowMultiQueries=true&useSSL=false&allowPublicKeyRetrieval=true\n      username: root\n      password: root\n      driver-class-name: com.mysql.cj.jdbc.Driver\n      type: com.alibaba.druid.pool.DruidDataSource\n      druid:\n        initial-size: 1\n        #最小连接池数量\n        #spring.datasource.druid\n        min-idle: 1\n        #最大连接池数量 maxIdle已经不再使用\n        max-active: 20\n        #获取连接时最大等待时间，单位毫秒\n        max-wait: 60000\n\n  # 指定单点登录服务链接\n  sso:\n    ssoService: http://192.168.90.128/sso\n    # 令牌在cookie中的参数名\n    cookieName: SSOID\n  sinoform:\n    # 指定工作流设计器服务链接\n    workflow-design-server-uri: 192.168.90.128\n    # 指定工作流引擎链接\n    workflow-server-uri: 192.168.90.128:18003\n    # 指定统一授权服务链接\n    uias-server-uri: 192.168.90.128\n")),(0,r.kt)("h4",{id:"自定义配置文件"},"自定义配置文件"),(0,r.kt)("p",null,"项目组在拿到",(0,r.kt)("inlineCode",{parentName:"p"},"sinoform"),"的 chart 安装包后，一般需要修改里面配置。"),(0,r.kt)("p",null,"可以根据本文档，自定义一个",(0,r.kt)("inlineCode",{parentName:"p"},"yaml"),"文件，安装 chart 时，指定该文件，可以覆盖 chart 中的",(0,r.kt)("inlineCode",{parentName:"p"},"values.yaml"),"部分配置。"),(0,r.kt)("p",null,"例如，项目组自定义一个",(0,r.kt)("inlineCode",{parentName:"p"},"myvalues.yaml"),"，内容如下："),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},'backend:\n  # 镜像版本（默认latest）\n  version: "1.15.0"\n')),(0,r.kt)("p",null,"chart 安装包中的",(0,r.kt)("inlineCode",{parentName:"p"},"values.yaml"),"中对应默认配置如下："),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},'backend:\n  # 镜像版本（默认latest）\n  version: ""\n')),(0,r.kt)("p",null,"那么，可以如下命令安装这个 chart："),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"helm install sinoform sinoform-0.0.1.tgz -f myvalues.yaml\n")),(0,r.kt)("p",null,"此时安装智能表单后端服务版本为",(0,r.kt)("inlineCode",{parentName:"p"},"1.15.0"),"，默认版本为",(0,r.kt)("inlineCode",{parentName:"p"},"latest"),"。其他配置不会改变，仍将使用默认值。"),(0,r.kt)("h4",{id:"验证配置文件格式是否正确"},"验证配置文件格式是否正确"),(0,r.kt)("p",null,"项目组可以通过以下命令验证，自定义的",(0,r.kt)("inlineCode",{parentName:"p"},"myvalues.yaml"),"是否有格式错误。"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"helm lint sinoform-0.0.1.tgz -f myvalues.yaml\n")),(0,r.kt)("p",null,"若出现如下提示，则表示没有问题："),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"...\n1 chart(s) linted, 0 chart(s) failed\n")),(0,r.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"使用",(0,r.kt)("inlineCode",{parentName:"p"},"lint"),"命令验证通过后，并不代表安装不会出错，验证结果只能作为参考。"))),(0,r.kt)("h2",{id:"部署智能表单"},"部署智能表单"),(0,r.kt)("h3",{id:"安装-chart"},"安装 Chart"),(0,r.kt)("p",null,"helm下载地址：",(0,r.kt)("a",{parentName:"p",href:"https://sino-intellisense-form.oss-cn-beijing.aliyuncs.com/sinoform-helm/sinoform-0.0.1.tgz"},"https://sino-intellisense-form.oss-cn-beijing.aliyuncs.com/sinoform-helm/sinoform-0.0.1.tgz")),(0,r.kt)("p",null,"配置好自定义配置文件后（例如自定义文件为",(0,r.kt)("inlineCode",{parentName:"p"},"myvalues.yaml"),"），可通过以下命令安装 chart"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"helm install sinoform sinoform-0.0.1.tgz -f myvalues.yaml\n")),(0,r.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"sinoform 为本次安装、发布的",(0,r.kt)("inlineCode",{parentName:"p"},"release"),"的名称。如果不写这个名称，则必须添加参数",(0,r.kt)("inlineCode",{parentName:"p"},"--generate-name"),"(或者简写",(0,r.kt)("inlineCode",{parentName:"p"},"-g"),")，helm 会自动生成一个",(0,r.kt)("inlineCode",{parentName:"p"},"release"),"名称。"))),(0,r.kt)("p",null,"出现如下内容，"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"[root@master helm]# helm install sinoform sinoform-0.0.1.tgz -f myvalues.yaml\nNAME: sinoform\nLAST DEPLOYED: Fri Mar 18 11:31:45 2022\nNAMESPACE: default\nSTATUS: deployed\nREVISION: 1\nTEST SUITE: None\n...\n")),(0,r.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"命令执行后，helm 客户端会立即退出，但是此时不代表已经安装完成。"),(0,r.kt)("p",{parentName:"div"},"此时可以查看",(0,r.kt)("inlineCode",{parentName:"p"},"kubectl get pod"),"结果，确定是否所有的",(0,r.kt)("inlineCode",{parentName:"p"},"pod"),"都已经启动。"))),(0,r.kt)("h3",{id:"访问"},"访问"),(0,r.kt)("p",null,"查看 ingress 端口号"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"[root@master sinoform]# kubectl get svc -n ingress-nginx\nNAME                                 TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)                      AGE\ningress-nginx-controller             NodePort    10.98.134.213   <none>        80:32400/TCP,443:31962/TCP   41h\ningress-nginx-controller-admission   ClusterIP   10.102.7.116    <none>        443/TCP                      41h\n")),(0,r.kt)("p",null,"其中",(0,r.kt)("inlineCode",{parentName:"p"},"32400"),"即为外部访问的端口号。"),(0,r.kt)("p",null,"稍等所有的",(0,r.kt)("inlineCode",{parentName:"p"},"pod"),"都已启动后，即可访问智能表单应用：http://","[ingress 地址:端口号]","/intellisense-form 。"),(0,r.kt)("h2",{id:"卸载-chart"},"卸载 Chart"),(0,r.kt)("p",null,"可通过以下命令卸载 Chart"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"helm uninstall sinoform\n")),(0,r.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},(0,r.kt)("inlineCode",{parentName:"p"},"sinoform"),"为安装时指定的",(0,r.kt)("inlineCode",{parentName:"p"},"release"),"名称，如果安装时没有指定名称，则可通过",(0,r.kt)("inlineCode",{parentName:"p"},"helm list"),"命令查看已安装的",(0,r.kt)("inlineCode",{parentName:"p"},"release"),"，找到",(0,r.kt)("inlineCode",{parentName:"p"},"sinoform"),"的",(0,r.kt)("inlineCode",{parentName:"p"},"release"),"名称，然后执行卸载命令。"))))}c.isMDXComponent=!0}}]);