---
id: guide-control-button-click
title: 控制按钮的点击行为
---

:::info 示例源码

本章节的示例代码可以在 [sinoform-plugins-web-component-examples/src/plugins/detail-page-extends](https://gitee.com/sinoui/sinoform-plugins-web-component-examples/tree/master/src/plugins/detail-page-extends) 中找到。

:::

我们可以通过扩展详情页业务逻辑的方式来添加`控制按钮点击行为`的方法。一般分成两步：

1. 创建扩展方法
2. 注册扩展方法

## 创建扩展方法

首先我们创建一个简单的示例方法，在点击`保存`按钮时，先在控制台输出一下表单内容，然后再执行保存方法。

```ts title="src/plugins/detail-page-extends/helloExtends.ts"
import AppSetting from "@sinoform/app-setting";

AppSetting.hooks.detailPage.tap(
  "controlButtonClickExtends",
  (detailPageContext) => {
    const { hooks, formData = {}, formState } = detailPageContext;
    const { formDesign: { id } = {} } = formData;

    if (id === "612df55ac9327f1383eb4bbb") {
      // 监听按钮点击事件，添加前置处理,返回false表示不再执行与后端交互的实际保存动作
      hooks.beforeButtonClick.tap("controlButtonClickExtends", (buttonId) => {
        if (buttonId === "save") {
          // 输出表单值
          console.log(formState.values);
        }
        return undefined;
      });
    }
  }
);
```

## 注册扩展方法

拓展方法开发完成之后只需要在`src/index.ts`中引入该文件，即可完成该拓展方法的注册。

```typescript
import "./plugins/detail-page-extends/controlButtonClickExtends";
```

## 更多示例

在一个有编号字段的表单中，点击`保存`按钮时，首先校验编号字段的值是否与已有数据重复，如果是，则设置校验失败的提示，并且不再执行保存操作；如果不重复，则直接保存。

```ts title="src/plugins/detail-page-extends/controlButtonClickExtends.ts"
import AppSetting from "@sinoform/app-setting";

AppSetting.hooks.detailPage.tap(
  "controlButtonClickExtends",
  (detailPageContext) => {
    const { hooks, formData = {}, formState } = detailPageContext;
    const { formDesign: { id } = {} } = formData;

    if (id === "612df55ac9327f1383eb4bbb") {
      // 监听按钮点击事件，添加前置处理,返回false表示不再执行与后端交互的实际保存动作
      hooks.beforeButtonClick.tap("controlButtonClickExtends", (buttonId) => {
        if (buttonId === "save") {
          // 判断编号是否等于已有编号
          if (formState.values["bianhao"] === "002") {
            // 设置校验错误
            formState.setFieldError("bianhao", "编号不能重复");
            formState.setFieldTouched("bianhao", true);

            // 返回false,表示不执行保存操作
            return false;
          }
        }
        return undefined;
      });
    }
  }
);
```

### 流程按钮标识（id）对照表

智能表单内置流程按钮标识（id）与名称对照表。

| 按钮名称 | 按钮标识(id)  |
| -------- | ------------- |
| 保存     | save          |
| 发送     | submit        |
| 退回     | back          |
| 退起草人 | sendBackDraft |
| 办结     | end           |
| 收回     | takeback      |
| 撤办     | cancelBack    |
| 恢复流程 | regainFlow    |
