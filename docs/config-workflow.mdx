---
id: config-workflow
title: 流程配置
---

import Tabs from "@theme/Tabs";
import TabItem from "@theme/TabItem";

智能表单默认与 sinomatrix 平台的工作流引擎交互，完成流程配置和流转的功能。我们可以通过本页介绍的配置项定义与工作流引擎交互的行为。

## sinoform.workflow-server-uri 配置项

`sinoform.workflow-server-uri` 配置项用来定义工作流引擎服务地址（`sino-matrix-workflow`），如下所示：

```yaml title="application-dev.yml"
sinoform:
  workflow-server-uri: 127.0.0.1:18003
```

## sinoform.workflow-design-server-uri 配置项

`sinoform.workflow-design-server-uri` 配置项用来定义 sinomatrix 中工作流设计器服务地址（`sino-matrix-workflow-design`），如下所示：

```yaml title="application-dev.yml"
sinoform:
  workflow-design-server-uri: 127.0.0.1:8080
```

## url.sync-workflow-items-url 配置项

`url.sync-workflow-items-url` 配置项用来定义业务实现的接受流程待办和已办数据的扩展接口链接，如下所示：

```yaml title="application-dev.yml"
url:
  sync-workflow-items-url: http://192.168.90.110:19001/custom-sync-workflow-items
```

:::info 何时使用此配置项

当您遇到以下情况时，需要使用配置项：

- 用户从业务系统中看到的待办、已办不是从工作流引擎中读取的
- 门户不是中科软的产品，需要将待办数据及时同步到第三方门户中去

:::

### 扩展接口约定

此扩展接口需要遵循以下接口约定：

```http
POST [接收待办、已办数据的扩展链接，您可以自行设计链接路径，如http://192.168.90.110:19001/custom-sync-workflow-items]
```

请求体是 `application/json` 格式的，示例数据如下：

```json
{
  "read": ["删除已办的SQL语句", "新增已办的SQL语句"],
  "write": ["删除待办的SQL语句", "新增待办的SQL语句"],
  "formId": "表单id",
  "appId": "应用id",
  "formDesignId": "表单设计id"
}
```

其中 `read` 和 `write` 字段的值是来自工作流引擎在提交流程时返回的同步待办和已办的 SQL 语句（由零个或者一个删除 SQL 语句和多个新增 SQL 语句组成），`read` 字段值是用来同步已办数据的 SQL，`write` 字段值是用来同步待办数据的 SQL。

SQL 示例如下：

<Tabs defaultValue="deleteRead"
  values={[
    { label: "删除已办", value: "deleteRead" },
    { label: "新增已办", value: "insertRead" },
    { label: "删除待办", value: "deleteWrite"},
    { label: "新增待办", value: "insertWrite"}
  ]}>
<TabItem value="deleteRead">

```sql title="删除已办的SQL语句"
delete from
  FLOW_READ
where
  FILETYPEID = '3396254c845548bdbbd1cd55973ac6f5'
  and DEPTID = '18043'
  and USERID = '1'
  and RECORDID = '619b8f49ec2ee8ac2f5b32ef';
```

</TabItem>
<TabItem value="insertRead">

```sql title="新增已办的SQL语句"
insert into
  FLOW_READ (
    HANDDONEURL,
    SYS_ID,
    CREATETIME,
    FILETYPEID,
    SUPERWORKFLOW,
    ACCFLAG,
    DEPTNAME,
    USERID,
    ID,
    READFLAG,
    WORKFLOWID,
    SUPERFILETYPE,
    GIVEACCUSER,
    DOCID,
    W_BACKUP,
    STATTAG,
    DRAFTUSER,
    WORKFLOWNAME,
    SORTID,
    FILETYPENAME,
    DRAFTDEPT,
    ACCINFO,
    USERNAME,
    ATTR,
    ATTR2,
    READTIME,
    ATTR1,
    BACKUP1,
    FORMURL,
    TITLE,
    UNIQUEID,
    DEPTID,
    RECORDID,
    PARA,
    LOGID,
    ORGANISEID,
    ACCDEPTID
  )
values
  (
    '',
    '67250',
    '2021-12-10 08:33:53',
    '3396254c845548bdbbd1cd55973ac6f5',
    '',
    '',
    '系统管理部',
    '1',
    'ca9a13f16b26439b9fab8fc0bcc380c4',
    '1',
    '3396254c845548bdbbd1cd55973ac6f5',
    '',
    '',
    '619b8f49ec2ee8ac2f5b32ef',
    '',
    '1',
    '1',
    '测试办结时间和起草部门名',
    '4f96523e1dc04339b8ed432effc76b3e',
    '测试办结时间和起草部门名',
    '18043',
    '',
    'admin',
    'intellisenseForm',
    '',
    '2021-12-10 08:33:53',
    '',
    'c49bbb22c698423eb7874e479aad9ee7',
    '619b32c3c9327f42e98a1882',
    '456456456456456456456',
    '4f96523e1dc04339b8ed432effc76b3e',
    '18043',
    '619b8f49ec2ee8ac2f5b32ef',
    '',
    '46aef7122a6d4dddb5c34a35173ad82d',
    '18043',
    ''
  );
```

</TabItem>
<TabItem value="deleteWrite">

```sql title="删除待办的SQL语句"
delete from
  FLOW_WRITE
where
  WORKFLOWINFOID = 'c49bbb22c698423eb7874e479aad9ee7';
```

</TabItem>
<TabItem value="insertWrite">

```sql title="新增待办的SQL语句"
insert into
  FLOW_WRITE(
    SYS_ID,
    PREUSERNAME,
    PREWFLEVELID,
    CREATETIME,
    FILETYPEID,
    WAITDOURL,
    WFLEVEID,
    PREUSERID,
    WFLEVENAME,
    SIGNTIME,
    LIMITTIME,
    SUPERWORKFLOW,
    DRAFTUSERNAME,
    PREORGANISEID,
    ACCFLAG,
    DEPTNAME,
    PREDEPTID,
    WORKFLOWINFOID,
    USERID,
    ID,
    WORKFLOWID,
    SUPERFILETYPE,
    GIVEACCUSER,
    PREWFLEVENAME,
    DOCID,
    W_BACKUP,
    STATTAG,
    OPSTATE,
    DRAFTUSER,
    WORKFLOWNAME,
    SORTID,
    FILETYPENAME,
    DRAFTDEPT,
    DRAFTWFLEVEID,
    ACCINFO,
    USERNAME,
    ATTR,
    ATTR2,
    BACKUP2,
    ATTR1,
    BACKUP1,
    FORMURL,
    TITLE,
    DEPTID,
    RECORDID,
    SIGNTAG,
    PREDEPTNAME,
    PARA,
    LOGID,
    ORGANISEID,
    ACCDEPTID,
    RECEIVETIME,
    DRAFTDEPTNAME
  )
values
(
    '67250',
    'admin',
    '63d85a21-d42f-4640-bc55-63e2aaf96378',
    '2021-12-10 08:33:53',
    '3396254c845548bdbbd1cd55973ac6f5',
    '/intellisense-form/619b32c3c9327f42e98a1882/todo',
    'a272b4b1-470f-468e-a229-7d8675a08ec7',
    '1',
    '审批节点',
    '',
    '',
    '',
    'admin',
    '18043',
    '0',
    '公文处/金融保险部/演示部门',
    '18043',
    'c49bbb22c698423eb7874e479aad9ee7',
    '4028d00e6f16845c016f79dda0c20231',
    '4f8d967525d744a08db02a3c00ab3234',
    '3396254c845548bdbbd1cd55973ac6f5',
    '',
    '',
    '开始节点',
    '619b8f49ec2ee8ac2f5b32ef',
    '',
    '1',
    '0',
    '1',
    '测试办结时间和起草部门名',
    '4f96523e1dc04339b8ed432effc76b3e',
    '测试办结时间和起草部门名',
    '18043',
    '63d85a21-d42f-4640-bc55-63e2aaf96378',
    '',
    '汪芳',
    'intellisenseForm',
    '',
    '',
    '',
    '',
    '619b32c3c9327f42e98a1882',
    '456456456456456456456',
    '4028d00e6ec96438016ec97b4b10000b',
    '619b8f49ec2ee8ac2f5b32ef',
    '0',
    '系统管理部',
    '',
    'b7a9b0fa987649b5aac3ca600069a5b4',
    '4028d00e6ec42073016ec4629a490001',
    '',
    '2021-12-10 08:33:53',
    '系统管理部'
  );
```

</TabItem>
</Tabs>

您可以通过解析 SQL 语句，知晓待办和已办发生的变化，从而同步到您的业务系统中去。

新增已办 SQL 中的关键字段说明：

| 字段名        | 示意值                           | 含义                    |
| ------------- | -------------------------------- | ----------------------- |
| ID            | ca9a13f16b26439b9fab8fc0bcc380c4 | 已办主键 ID             |
| TITLE         | 456456456456456456456            | 标题                    |
| FILETYPEID    | 3396254c845548bdbbd1cd55973ac6f5 | 流程 ID                 |
| FILETYPENAME  | 测试办结时间和起草部门名         | 流程名称                |
| WORKFLOWID    | 3396254c845548bdbbd1cd55973ac6f5 | 流程唯一 ID             |
| WORKFLOWNAME  | 测试办结时间和起草部门名         | 流程名称+版本名称       |
| RECORDID      | 619b8f49ec2ee8ac2f5b32ef         | 流转 ID                 |
| CREATETIME    | 2021-12-10 08:33:53              | 启动时间                |
| USERID        | 1                                | 办理人用户 ID           |
| DEPTID        | 18043                            | 办理人所在的部门 ID     |
| ORGANISEID    | 18043                            | 办理人所在的组织体系 ID |
| READTIME      | 2021-12-10 08:33:53              | 办理时间                |
| READFLAG      | 1                                | 办理标志                |
| UNIQUEID      | 4f96523e1dc04339b8ed432effc76b3e | 全局流转唯一 ID         |
| PARA          |                                  | 业务属性值的集合        |
| DRAFTDEPT     | 18043                            | 拟稿人所在的部门 ID     |
| DRAFTUSER     | 1                                | 拟稿人的用户 ID         |
| STATTAG       | 1                                | 状态标识                |
| HANDDONEURL   |                                  | 已办 URL                |
| DOCID         | 619b8f49ec2ee8ac2f5b32ef         | 业务记录主键值          |
| FORMURL       | 619b32c3c9327f42e98a1882         | 表单 ID                 |
| SORTID        | 4f96523e1dc04339b8ed432effc76b3e | 流程分类 ID             |
| SUPERFILETYPE |                                  | 父流程 ID               |
| SYS_ID        | 67250                            | 系统                    |
| ACCINFO       |                                  | 待办授权信息            |
| GIVEACCUSER   |                                  | 授权人用 户 ID          |
| ACCDEPTID     |                                  | 被授权人所在部门 ID     |
| ACCFLAG       |                                  | 是否授权                |
| USERNAME      | admin                            | 办理人用户名称          |
| DEPTNAME      | 系统管理部                       | 办理人部门名称          |
| ATTR          | intellisenseForm                 | 业务属性                |
| LOGID         | 46aef7122a6d4dddb5c34a35173ad82d | 日志 ID                 |

新增待办 SQL 中的关键字段说明：

| 字段名             | 示意值                                           | 含义                                                              |
| ------------------ | ------------------------------------------------ | ----------------------------------------------------------------- |
| ID                 | 4f8d967525d744a08db02a3c00ab3234                 | 主键 ID 值                                                        |
| WORKFLOWINFOID     | c49bbb22c698423eb7874e479aad9ee7                 | 关联的流转实例 ID                                                 |
| TITLE              | 456456456456456456456                            | 标题                                                              |
| RECORDID           | 619b8f49ec2ee8ac2f5b32ef                         | 流转 ID                                                           |
| FILETYPEID         | 3396254c845548bdbbd1cd55973ac6f5                 | 流程 ID                                                           |
| FILETYPENAME       | 测试办结时间和起草部门名                         | 流程名称                                                          |
| WORKFLOWID         | 3396254c845548bdbbd1cd55973ac6f5                 | 流程唯一 ID                                                       |
| WORKFLOWNAME       | 测试办结时间和起草部门名                         | 流程名称+版本名称                                                 |
| USERID             | 4028d00e6f16845c016f79dda0c20231                 | 参与者用户 ID                                                     |
| DEPTID             | 4028d00e6ec96438016ec97b4b10000b                 | 参与者所在的部门 ID                                               |
| ORGANISEID         | 4028d00e6ec42073016ec4629a490001                 | 参与者所在的组织体系 ID                                           |
| RECEIVETIME        | 2021-12-10 08:33:53                              | 接收时间                                                          |
| SIGNTIME           |                                                  | 签收时间                                                          |
| SIGNTAG            | 0                                                | 签收标志 1-签收 0-未签收                                          |
| LIMITTIME          |                                                  | 待办逾期时间                                                      |
| PREUSERID          | 1                                                | 前继参与者用户 ID                                                 |
| PREDEPTID          | 18043                                            | 前继参与者所在部门 ID                                             |
| PREORGANISEID      | 18043                                            | 前继参与者所在组织体系 ID                                         |
| CREATETIME         | 2021-12-10 08:33:53                              | 启动时间                                                          |
| PARA               |                                                  | 业务数据 格式：变量名=值, 变量名=值                               |
| DRAFTUSER          | 1                                                | 拟稿人用户 ID                                                     |
| DRAFTDEPT          | 18043                                            | 拟稿人所在部门 ID                                                 |
| ACCDEPTID          |                                                  | 被授权人所在部门 ID                                               |
| ACCINFO            |                                                  | 授权描述信息                                                      |
| GIVEACCUSER        |                                                  | 授权人用户 ID                                                     |
| WFLEVEID           | a272b4b1-470f-468e-a229-7d8675a08ec7             | 当前待办节点 ID                                                   |
| STATTAG            | 1                                                | 状态标识 1-在办 0-撤办                                            |
| PREWFLEVELID       | 63d85a21-d42f-4640-bc55-63e2aaf96378             | 前继办理节点 ID                                                   |
| SUPERFILETYPE      |                                                  | 父流程 ID                                                         |
| ACCFLAG            | 0                                                | 是否代办授权标志 1-授权 0-未授权                                  |
| ATTR               | intellisenseForm                                 | 业务属性 存放缓急、密级等业务属性。出待办列表可以按此业务属性排序 |
| ATTR1              |                                                  | 业务属性 1                                                        |
| ATTR2              |                                                  | 业务属性 2                                                        |
| FORMURL            | 619b32c3c9327f42e98a1882                         | 表单 ID                                                           |
| LOGID              | b7a9b0fa987649b5aac3ca600069a5b4                 | 关联的日志 ID                                                     |
| WAITDOURL          | /intellisense-form/619b32c3c9327f42e98a1882/todo | 待办 URL                                                          |
| DOCID              | 619b8f49ec2ee8ac2f5b32ef                         | 业务记录主键 ID 值                                                |
| SUPERWORKFLOW      |                                                  | 父流程唯一 ID                                                     |
| SORTID             | 4f96523e1dc04339b8ed432effc76b3e                 | 全局流转的唯一 ID                                                 |
| WORKFLOWINFOID_INT |                                                  | 主键的整型值（只有为数字串，此字段才会有值）                      |
| OPSTATE            | 0                                                | 路由状态                                                          |
| USERNAME           | 汪芳                                             | 当前待办人的用户名                                                |
| DEPTNAME           | 公文处/金融保险部/演示部门                       | 当前待办人所在部门名称                                            |
| SYS_ID             | 67250                                            | 应用系统 id                                                       |
| PREUSERNAME        | admin                                            | 前继办理用户名                                                    |
| WFLEVENAME         | 审批节点                                         | 当前待办节点名                                                    |
| DRAFTUSERNAME      | admin                                            | 起草人                                                            |
| DRAFTDEPTNAME      | 系统管理部                                       | 起草人所在部门名称                                                |
| PREWFLEVENAME      | 开始节点                                         | 前继办理节点名                                                    |
| PREDEPTNAME        | 系统管理部                                       | 前继办理人所在部门名称                                            |
| DRAFTWFLEVEID      | 63d85a21-d42f-4640-bc55-63e2aaf96378             | 起草节点 ID                                                       |

:::info 推荐

推荐您使用 [jsqlparser](https://github.com/JSQLParser/JSqlParser) 库解析 SQL。

:::

#### 特例：撤办和恢复流程

> v1.12.11

撤办和恢复流程时，发出同步待办已办 SQL 语句是 `UPDATE` 语句，如下所示：

撤办的示例数据：

```json
{
  "read": [
    "update FLOW_READ set STATTAG='0' where RECORDID='61dfe597ec2eb92c3cdd23da'"
  ],
  "write": [
    "update FLOW_WRITE set STATTAG='0' where RECORDID='61dfe597ec2eb92c3cdd23da'"
  ],
  "formId": "表单id",
  "appId": "应用id",
  "formDesignId": "表单设计id"
}
```

恢复流程的示例数据：

```json
{
  "read": [
    "update FLOW_READ set STATTAG='1' where RECORDID='61dfe597ec2eb92c3cdd23da'"
  ],
  "write": [
    "update FLOW_WRITE set STATTAG='1' where RECORDID='61dfe597ec2eb92c3cdd23da'"
  ],
  "formId": "表单id",
  "appId": "应用id",
  "formDesignId": "表单设计id"
}
```
