---
id: guide-formfield
title: 开发一个表单项
---

一个完整的表单项需要有三个组件来完成

- render。表单项渲染组件
- preview。表单项预览组件
- configPanel。表单项的属性配置面板组件，目前属性面板只支持以 react 组件的方式开发

:::info 示例源码

本章节得示例代码可以在[sinoform-plugins-web-component-examples/src/plugins/form-field-input](https://gitee.com/sinoui/sinoform-plugins-web-component-examples/tree/master/src/plugins/form-field-input)中找到。

:::

### 开发 CustomInputRenderer 组件

```ts
import { SinoFormElement } from "@sinoform/plugin-sinoform-helpers";
import "./index.css";

/**
 * 自定义文本框在表单中展示的组件
 */
export default class CustomInputRenderer extends SinoFormElement {
  override render() {
    this.innerHTML = `<input class="custom-input"  />`;
  }
}
```

上面代码创建了一个最基本的 input 输入框，接下来我们需要给这个 input 添加一些代码完成输入框与当前表单状态的交互，我们能实时获取表单当前值的变化，也能在 input 发生变化时实时更新当前表单状态。

```typescript
const { value = "", readOnly, id, name } = this.props;
this.innerHTML = `<input class="custom-input" name="${name}" id="${id}" value="${value}" ${
  readOnly ? `readonly="readonly"` : ""
} />`;
const $input = $("input", this);

// 绑定表单控件。绑定做了两件事，即：
// 1. 监听 this.props 中的 value 属性值变更，同步到 $input 中
// 2. 监听 $input 中的 change 事件，将用户输入的值通过 this.props.onChange 告知智能表单
this.bindFormControl($input);
```

如果我们需要监听表单值的变化，可以使用`watch`方法

```typescript
// 监听 readOnly 属性值变更
this.props.watch("readOnly", (readOnly) => {
  if (readOnly) {
    $input.attr("readonly", "readonly");
  } else {
    $input.removeAttr("readonly");
  }
});
```

至此，表单项的值在组件内部的回显处理完毕。

完整的示例代码

```ts
import $ from "jquery";
import { SinoFormElement } from "@sinoform/plugin-sinoform-helpers";
import "./index.css";

/**
 * 自定义文本框在表单中展示的组件
 */
export default class CustomInputRenderer extends SinoFormElement {
  override render() {
    const { value = "", readOnly, id, name } = this.props;
    this.innerHTML = `<input class="custom-input" name="${name}" id="${id}" value="${value}" ${
      readOnly ? `readonly="readonly"` : ""
    } />`;
    const $input = $("input", this);

    // 绑定表单控件。绑定做了两件事，即：
    // 1. 监听 this.props 中的 value 属性值变更，同步到 $input 中
    // 2. 监听 $input 中的 change 事件，将用户输入的值通过 this.props.onChange 告知智能表单
    this.bindFormControl($input);

    // 监听 readOnly 属性值变更
    this.props.watch("readOnly", (readOnly) => {
      if (readOnly) {
        $input.attr("readonly", "readonly");
      } else {
        $input.removeAttr("readonly");
      }
    });
  }
}
```

preview 组件是预览组件，不涉及业务逻辑交互，不需要事件监听处理，属于比较纯粹的 ui 组件。

## 在智能表单产品中调试插件

本小节以智能表单外网演示环境来说明如何在智能表单产品中调试插件。

打开[登录页](http://121.30.232.162:18880/sso/)，使用账号 `智能表单管理员`（密码是：`1qaz2wsx!`） 登录系统，然后选择表单设计器，进入智能表单管理页面。

打开表单`演示自定义表单项`，在表单设计界面可以在左侧的基础字段中看到新增的自定义表单项，拖动它到中间区域就可以完整自定义表单项的添加。

![设计界面](assets/custominput-in-design.png)

打开预览界面就可以实时测试自定义表单项的功能。

![预览界面](assets/custominput-in-preview.png)

进入产品示例系统，在`演示自定义表单项`的表单详情页中也可以测试自定义表单项。

![详情界面](assets/custominput-in-detail.png)
